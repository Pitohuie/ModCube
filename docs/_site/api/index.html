<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=Edge"> <link rel="stylesheet" href="/ModCube.github.io/assets/css/just-the-docs-default.css"> <link rel="stylesheet" href="/ModCube.github.io/assets/css/just-the-docs-head-nav.css" id="jtd-head-nav-stylesheet"> <style id="jtd-nav-activation"> .site-nav > ul.nav-list:first-child > li:not(:nth-child(4)) > a, .site-nav > ul.nav-list:first-child > li > ul > li a { background-image: none; } .site-nav > ul.nav-list:not(:first-child) a, .site-nav li.external a { background-image: none; } .site-nav > ul.nav-list:first-child > li:nth-child(4) > a { font-weight: 600; text-decoration: none; }.site-nav > ul.nav-list:first-child > li:nth-child(4) > button svg { transform: rotate(-90deg); }.site-nav > ul.nav-list:first-child > li.nav-list-item:nth-child(4) > ul.nav-list { display: block; } </style> <script src="/ModCube.github.io/assets/js/vendor/lunr.min.js"></script> <script src="/ModCube.github.io/assets/js/just-the-docs.js"></script> <meta name="viewport" content="width=device-width, initial-scale=1"> <!-- Begin Jekyll SEO tag v2.8.0 --> <title>API Documentation | RS-ModCubes</title> <meta name="generator" content="Jekyll v4.3.4" /> <meta property="og:title" content="API Documentation" /> <meta name="author" content="Jiaxi Zheng" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="Self-Reconfigurable, Scalable Modular Cubic Robots for Underwater Operations" /> <meta property="og:description" content="Self-Reconfigurable, Scalable Modular Cubic Robots for Underwater Operations" /> <link rel="canonical" href="http://0.0.0.0:4000/ModCube.github.io/api/" /> <meta property="og:url" content="http://0.0.0.0:4000/ModCube.github.io/api/" /> <meta property="og:site_name" content="RS-ModCubes" /> <meta property="og:type" content="website" /> <meta name="twitter:card" content="summary" /> <meta property="twitter:title" content="API Documentation" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"WebPage","author":{"@type":"Person","name":"Jiaxi Zheng"},"description":"Self-Reconfigurable, Scalable Modular Cubic Robots for Underwater Operations","headline":"API Documentation","url":"http://0.0.0.0:4000/ModCube.github.io/api/"}</script> <!-- End Jekyll SEO tag --> </head> <body> <a class="skip-to-main" href="#main-content">Skip to main content</a> <svg xmlns="http://www.w3.org/2000/svg" class="d-none"> <symbol id="svg-link" viewBox="0 0 24 24"> <title>Link</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"> <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"> <title>Menu</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"> <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"> <title>Expand</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"> <polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <!-- Feather. MIT License: https://github.com/feathericons/feather/blob/master/LICENSE --> <symbol id="svg-external-link" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-external-link"> <title id="svg-external-link-title">(external link)</title> <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"> <title>Document</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"> <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"> <title>Search</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <!-- Bootstrap Icons. MIT License: https://github.com/twbs/icons/blob/main/LICENSE.md --> <symbol id="svg-copy" viewBox="0 0 16 16"> <title>Copy</title> <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard" viewBox="0 0 16 16"> <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z"/> <path d="M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3zm-3-1A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3z"/> </svg> </symbol> <symbol id="svg-copied" viewBox="0 0 16 16"> <title>Copied</title> <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard-check-fill" viewBox="0 0 16 16"> <path d="M6.5 0A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3Zm3 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3Z"/> <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1A2.5 2.5 0 0 1 9.5 5h-3A2.5 2.5 0 0 1 4 2.5v-1Zm6.854 7.354-3 3a.5.5 0 0 1-.708 0l-1.5-1.5a.5.5 0 0 1 .708-.708L7.5 10.793l2.646-2.647a.5.5 0 0 1 .708.708Z"/> </svg> </symbol> </svg> <div class="side-bar"> <div class="site-header" role="banner"> <a href="/ModCube.github.io/" class="site-title lh-tight"> RS-ModCubes </a> <button id="menu-button" class="site-button btn-reset" aria-label="Toggle menu" aria-pressed="false"> <svg viewBox="0 0 24 24" class="icon" aria-hidden="true"><use xlink:href="#svg-menu"></use></svg> </button> </div> <nav aria-label="Main" id="site-nav" class="site-nav"> <ul class="nav-list"><li class="nav-list-item"><a href="/ModCube.github.io/" class="nav-list-link">Home</a></li><li class="nav-list-item"><a href="/ModCube.github.io/architecture/" class="nav-list-link">System Architecture</a></li><li class="nav-list-item"><a href="/ModCube.github.io/tutorials/" class="nav-list-link">Tutorials</a></li><li class="nav-list-item"><a href="/ModCube.github.io/api/" class="nav-list-link">API Documentation</a></li><li class="nav-list-item"><a href="/ModCube.github.io/examples/" class="nav-list-link">Examples</a></li><li class="nav-list-item"><a href="/ModCube.github.io/installation/" class="nav-list-link">Installation Guide</a></li><li class="nav-list-item"><a href="/ModCube.github.io/faq/" class="nav-list-link">FAQ</a></li><li class="nav-list-item"><a href="/ModCube.github.io/contributing/" class="nav-list-link">Contributing</a></li><li class="nav-list-item"><a href="/ModCube.github.io/changelog/" class="nav-list-link">Changelog</a></li></ul> <ul class="nav-list"><li class="nav-list-item external"> <a href="https://github.com/jiaxi-zheng/ModCube.github.io" class="nav-list-link external" > GitHub Repository <svg viewBox="0 0 24 24" aria-labelledby="svg-external-link-title"><use xlink:href="#svg-external-link"></use></svg> </a> </li></ul> </nav> <footer class="site-footer"> This site uses <a href="https://github.com/just-the-docs/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll. </footer> </div> <div class="main" id="top"> <div id="main-header" class="main-header"> <div class="search" role="search"> <div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search RS-ModCubes" aria-label="Search RS-ModCubes" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label> </div> <div id="search-results" class="search-results"></div> </div> </div> <div class="main-content-wrap"> <div id="main-content" class="main-content"> <main> <h1 id="api-documentation"> <a href="#api-documentation" class="anchor-heading" aria-labelledby="api-documentation"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> API Documentation </h1> <p>This document provides comprehensive API documentation for the RS-ModCubes system, including ROS topics, services, messages, and Python APIs. The system implements advanced underwater robotics capabilities with modular architecture for autonomous underwater vehicles (AUVs).</p> <h2 id="table-of-contents"> <a href="#table-of-contents" class="anchor-heading" aria-labelledby="table-of-contents"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Table of Contents </h2> <ol> <li><a href="#ros-topics">ROS Topics</a></li> <li><a href="#ros-services">ROS Services</a></li> <li><a href="#message-definitions">Message Definitions</a></li> <li><a href="#python-apis">Python APIs</a></li> <li><a href="#cpp-apis">C++ APIs</a></li> <li><a href="#state-estimation-apis">State Estimation APIs</a></li> <li><a href="#trajectory-generation-apis">Trajectory Generation APIs</a></li> <li><a href="#configuration-parameters">Configuration Parameters</a></li> <li><a href="#plugin-apis">Plugin APIs</a></li> <li><a href="#examples">Examples</a></li> </ol> <h2 id="ros-topics"> <a href="#ros-topics" class="anchor-heading" aria-labelledby="ros-topics"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> ROS Topics </h2> <h3 id="control-topics"> <a href="#control-topics" class="anchor-heading" aria-labelledby="control-topics"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Control Topics </h3> <h4 id="modcubecontroller_command"> <a href="#modcubecontroller_command" class="anchor-heading" aria-labelledby="modcubecontroller_command"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <code class="language-plaintext highlighter-rouge">/modcube/controller_command</code> </h4> <p><strong>Type</strong>: <code class="language-plaintext highlighter-rouge">modcube_msgs/ControllerCommand</code><br /> <strong>Description</strong>: High-level control commands for the vehicle<br /> <strong>Publisher</strong>: Mission planner, teleop nodes<br /> <strong>Subscriber</strong>: PID controller</p> <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Message structure</span>
<span class="na">header</span><span class="pi">:</span>
  <span class="na">stamp</span><span class="pi">:</span> <span class="s">time</span>
  <span class="na">frame_id</span><span class="pi">:</span> <span class="s">string</span>
<span class="na">mode</span><span class="pi">:</span> <span class="s">int32</span>          <span class="c1"># Control mode (1=position, 2=velocity, 3=acceleration)</span>
<span class="na">setpoint</span><span class="pi">:</span>
  <span class="na">position</span><span class="pi">:</span>          <span class="c1"># Target position (mode 1)</span>
    <span class="na">x</span><span class="pi">:</span> <span class="s">float64</span>
    <span class="na">y</span><span class="pi">:</span> <span class="s">float64</span>
    <span class="na">z</span><span class="pi">:</span> <span class="s">float64</span>
  <span class="na">orientation</span><span class="pi">:</span>       <span class="c1"># Target orientation (quaternion)</span>
    <span class="na">x</span><span class="pi">:</span> <span class="s">float64</span>
    <span class="na">y</span><span class="pi">:</span> <span class="s">float64</span>
    <span class="na">z</span><span class="pi">:</span> <span class="s">float64</span>
    <span class="na">w</span><span class="pi">:</span> <span class="s">float64</span>
  <span class="na">linear</span><span class="pi">:</span>           <span class="c1"># Target linear velocity (mode 2)</span>
    <span class="na">x</span><span class="pi">:</span> <span class="s">float64</span>
    <span class="na">y</span><span class="pi">:</span> <span class="s">float64</span>
    <span class="na">z</span><span class="pi">:</span> <span class="s">float64</span>
  <span class="na">angular</span><span class="pi">:</span>          <span class="c1"># Target angular velocity (mode 2)</span>
    <span class="na">x</span><span class="pi">:</span> <span class="s">float64</span>
    <span class="na">y</span><span class="pi">:</span> <span class="s">float64</span>
    <span class="na">z</span><span class="pi">:</span> <span class="s">float64</span>
</code></pre></div></div> <h4 id="modcubethrust_command"> <a href="#modcubethrust_command" class="anchor-heading" aria-labelledby="modcubethrust_command"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <code class="language-plaintext highlighter-rouge">/modcube/thrust_command</code> </h4> <p><strong>Type</strong>: <code class="language-plaintext highlighter-rouge">modcube_msgs/ThrusterCommand</code><br /> <strong>Description</strong>: Direct thruster control commands<br /> <strong>Publisher</strong>: Thruster manager, controllers<br /> <strong>Subscriber</strong>: Hardware drivers</p> <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Message structure</span>
<span class="na">header</span><span class="pi">:</span>
  <span class="na">stamp</span><span class="pi">:</span> <span class="s">time</span>
  <span class="na">frame_id</span><span class="pi">:</span> <span class="s">string</span>
<span class="na">thrusters</span><span class="pi">:</span> <span class="s">float64[14]</span>  <span class="c1"># Thrust values for 14 thrusters (-1.0 to 1.0)</span>
</code></pre></div></div> <h3 id="state-topics"> <a href="#state-topics" class="anchor-heading" aria-labelledby="state-topics"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> State Topics </h3> <h4 id="modcubenav_state"> <a href="#modcubenav_state" class="anchor-heading" aria-labelledby="modcubenav_state"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <code class="language-plaintext highlighter-rouge">/modcube/nav_state</code> </h4> <p><strong>Type</strong>: <code class="language-plaintext highlighter-rouge">modcube_msgs/NavState</code><br /> <strong>Description</strong>: Current navigation state of the vehicle<br /> <strong>Publisher</strong>: State estimator<br /> <strong>Subscriber</strong>: Controllers, mission planner</p> <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Message structure</span>
<span class="na">header</span><span class="pi">:</span>
  <span class="na">stamp</span><span class="pi">:</span> <span class="s">time</span>
  <span class="na">frame_id</span><span class="pi">:</span> <span class="s">string</span>
<span class="na">pose</span><span class="pi">:</span>
  <span class="na">pose</span><span class="pi">:</span>
    <span class="na">position</span><span class="pi">:</span>
      <span class="na">x</span><span class="pi">:</span> <span class="s">float64</span>
      <span class="na">y</span><span class="pi">:</span> <span class="s">float64</span>
      <span class="na">z</span><span class="pi">:</span> <span class="s">float64</span>
    <span class="na">orientation</span><span class="pi">:</span>
      <span class="na">x</span><span class="pi">:</span> <span class="s">float64</span>
      <span class="na">y</span><span class="pi">:</span> <span class="s">float64</span>
      <span class="na">z</span><span class="pi">:</span> <span class="s">float64</span>
      <span class="na">w</span><span class="pi">:</span> <span class="s">float64</span>
  <span class="na">covariance</span><span class="pi">:</span> <span class="s">float64[36]</span>
<span class="na">twist</span><span class="pi">:</span>
  <span class="na">twist</span><span class="pi">:</span>
    <span class="na">linear</span><span class="pi">:</span>
      <span class="na">x</span><span class="pi">:</span> <span class="s">float64</span>
      <span class="na">y</span><span class="pi">:</span> <span class="s">float64</span>
      <span class="na">z</span><span class="pi">:</span> <span class="s">float64</span>
    <span class="na">angular</span><span class="pi">:</span>
      <span class="na">x</span><span class="pi">:</span> <span class="s">float64</span>
      <span class="na">y</span><span class="pi">:</span> <span class="s">float64</span>
      <span class="na">z</span><span class="pi">:</span> <span class="s">float64</span>
  <span class="na">covariance</span><span class="pi">:</span> <span class="s">float64[36]</span>
</code></pre></div></div> <h3 id="sensor-topics"> <a href="#sensor-topics" class="anchor-heading" aria-labelledby="sensor-topics"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Sensor Topics </h3> <h4 id="modcubeimudata"> <a href="#modcubeimudata" class="anchor-heading" aria-labelledby="modcubeimudata"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <code class="language-plaintext highlighter-rouge">/modcube/imu/data</code> </h4> <p><strong>Type</strong>: <code class="language-plaintext highlighter-rouge">sensor_msgs/Imu</code><br /> <strong>Description</strong>: IMU sensor data<br /> <strong>Publisher</strong>: IMU driver<br /> <strong>Subscriber</strong>: State estimator</p> <h4 id="modcubedvldata"> <a href="#modcubedvldata" class="anchor-heading" aria-labelledby="modcubedvldata"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <code class="language-plaintext highlighter-rouge">/modcube/dvl/data</code> </h4> <p><strong>Type</strong>: <code class="language-plaintext highlighter-rouge">modcube_msgs/DVLData</code><br /> <strong>Description</strong>: DVL sensor data<br /> <strong>Publisher</strong>: DVL driver<br /> <strong>Subscriber</strong>: State estimator</p> <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># DVLData message structure</span>
<span class="na">header</span><span class="pi">:</span>
  <span class="na">stamp</span><span class="pi">:</span> <span class="s">time</span>
  <span class="na">frame_id</span><span class="pi">:</span> <span class="s">string</span>
<span class="na">velocity</span><span class="pi">:</span>
  <span class="na">x</span><span class="pi">:</span> <span class="s">float64</span>
  <span class="na">y</span><span class="pi">:</span> <span class="s">float64</span>
  <span class="na">z</span><span class="pi">:</span> <span class="s">float64</span>
<span class="na">altitude</span><span class="pi">:</span> <span class="s">float64</span>
<span class="na">beam_ranges</span><span class="pi">:</span> <span class="s">float64[4]</span>
<span class="na">beam_velocities</span><span class="pi">:</span> <span class="s">float64[4]</span>
<span class="na">status</span><span class="pi">:</span> <span class="s">int32</span>
</code></pre></div></div> <h4 id="modcubedepth"> <a href="#modcubedepth" class="anchor-heading" aria-labelledby="modcubedepth"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <code class="language-plaintext highlighter-rouge">/modcube/depth</code> </h4> <p><strong>Type</strong>: <code class="language-plaintext highlighter-rouge">modcube_msgs/FluidDepth</code><br /> <strong>Description</strong>: Depth sensor data<br /> <strong>Publisher</strong>: Depth sensor driver<br /> <strong>Subscriber</strong>: State estimator</p> <h3 id="mission-topics"> <a href="#mission-topics" class="anchor-heading" aria-labelledby="mission-topics"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Mission Topics </h3> <h4 id="modcubemission_state"> <a href="#modcubemission_state" class="anchor-heading" aria-labelledby="modcubemission_state"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <code class="language-plaintext highlighter-rouge">/modcube/mission_state</code> </h4> <p><strong>Type</strong>: <code class="language-plaintext highlighter-rouge">modcube_msgs/MissionState</code><br /> <strong>Description</strong>: Current mission status<br /> <strong>Publisher</strong>: Mission manager<br /> <strong>Subscriber</strong>: Mission monitor, GUI</p> <h4 id="modcubealarms"> <a href="#modcubealarms" class="anchor-heading" aria-labelledby="modcubealarms"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <code class="language-plaintext highlighter-rouge">/modcube/alarms</code> </h4> <p><strong>Type</strong>: <code class="language-plaintext highlighter-rouge">modcube_msgs/Alarm</code><br /> <strong>Description</strong>: System alarms and warnings<br /> <strong>Publisher</strong>: Various nodes<br /> <strong>Subscriber</strong>: Mission manager, safety monitor</p> <h3 id="trajectory-and-path-planning-topics"> <a href="#trajectory-and-path-planning-topics" class="anchor-heading" aria-labelledby="trajectory-and-path-planning-topics"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Trajectory and Path Planning Topics </h3> <h4 id="modcubetrajectorypath"> <a href="#modcubetrajectorypath" class="anchor-heading" aria-labelledby="modcubetrajectorypath"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <code class="language-plaintext highlighter-rouge">/modcube/trajectory/path</code> </h4> <p><strong>Type</strong>: <code class="language-plaintext highlighter-rouge">nav_msgs/Path</code><br /> <strong>Description</strong>: Planned trajectory path for visualization<br /> <strong>Publisher</strong>: PID planner, trajectory generator<br /> <strong>Subscriber</strong>: RViz, mission monitor</p> <h4 id="modcubetrajectorytarget"> <a href="#modcubetrajectorytarget" class="anchor-heading" aria-labelledby="modcubetrajectorytarget"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <code class="language-plaintext highlighter-rouge">/modcube/trajectory/target</code> </h4> <p><strong>Type</strong>: <code class="language-plaintext highlighter-rouge">geometry_msgs/PoseStamped</code><br /> <strong>Description</strong>: Current trajectory target pose<br /> <strong>Publisher</strong>: Trajectory generator<br /> <strong>Subscriber</strong>: PID planner, controllers</p> <h4 id="modcubetrajectoryrequest"> <a href="#modcubetrajectoryrequest" class="anchor-heading" aria-labelledby="modcubetrajectoryrequest"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <code class="language-plaintext highlighter-rouge">/modcube/trajectory/request</code> </h4> <p><strong>Type</strong>: <code class="language-plaintext highlighter-rouge">modcube_msgs/GetTrajectoryRequest</code><br /> <strong>Description</strong>: Request for trajectory generation<br /> <strong>Publisher</strong>: Mission planner<br /> <strong>Subscriber</strong>: Trajectory generator</p> <h3 id="debug-and-monitoring-topics"> <a href="#debug-and-monitoring-topics" class="anchor-heading" aria-labelledby="debug-and-monitoring-topics"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Debug and Monitoring Topics </h3> <h4 id="modcubedebugpid_output"> <a href="#modcubedebugpid_output" class="anchor-heading" aria-labelledby="modcubedebugpid_output"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <code class="language-plaintext highlighter-rouge">/modcube/debug/pid_output</code> </h4> <p><strong>Type</strong>: <code class="language-plaintext highlighter-rouge">modcube_msgs/PIDDebug</code><br /> <strong>Description</strong>: PID controller debug information<br /> <strong>Publisher</strong>: PID planner<br /> <strong>Subscriber</strong>: Debug monitor, tuning tools</p> <h4 id="modcubedebugekf_state"> <a href="#modcubedebugekf_state" class="anchor-heading" aria-labelledby="modcubedebugekf_state"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <code class="language-plaintext highlighter-rouge">/modcube/debug/ekf_state</code> </h4> <p><strong>Type</strong>: <code class="language-plaintext highlighter-rouge">modcube_msgs/EKFDebug</code><br /> <strong>Description</strong>: Extended Kalman Filter internal state<br /> <strong>Publisher</strong>: State estimator<br /> <strong>Subscriber</strong>: Debug monitor, analysis tools</p> <h4 id="modcubedebugthruster_allocation"> <a href="#modcubedebugthruster_allocation" class="anchor-heading" aria-labelledby="modcubedebugthruster_allocation"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <code class="language-plaintext highlighter-rouge">/modcube/debug/thruster_allocation</code> </h4> <p><strong>Type</strong>: <code class="language-plaintext highlighter-rouge">modcube_msgs/ThrusterAllocation</code><br /> <strong>Description</strong>: Thruster allocation matrix output<br /> <strong>Publisher</strong>: Thruster manager<br /> <strong>Subscriber</strong>: Debug monitor, performance analysis</p> <h2 id="ros-services"> <a href="#ros-services" class="anchor-heading" aria-labelledby="ros-services"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> ROS Services </h2> <h3 id="control-services"> <a href="#control-services" class="anchor-heading" aria-labelledby="control-services"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Control Services </h3> <h4 id="modcubeset_pid_params"> <a href="#modcubeset_pid_params" class="anchor-heading" aria-labelledby="modcubeset_pid_params"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <code class="language-plaintext highlighter-rouge">/modcube/set_pid_params</code> </h4> <p><strong>Type</strong>: <code class="language-plaintext highlighter-rouge">modcube_msgs/SetPIDParams</code><br /> <strong>Description</strong>: Set PID controller parameters</p> <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Request</span>
<span class="na">position_gains</span><span class="pi">:</span>
  <span class="na">p</span><span class="pi">:</span> <span class="s">float64[3]</span>  <span class="c1"># [x, y, z]</span>
  <span class="na">i</span><span class="pi">:</span> <span class="s">float64[3]</span>
  <span class="na">d</span><span class="pi">:</span> <span class="s">float64[3]</span>
<span class="na">orientation_gains</span><span class="pi">:</span>
  <span class="na">p</span><span class="pi">:</span> <span class="s">float64[3]</span>  <span class="c1"># [roll, pitch, yaw]</span>
  <span class="na">i</span><span class="pi">:</span> <span class="s">float64[3]</span>
  <span class="na">d</span><span class="pi">:</span> <span class="s">float64[3]</span>

<span class="c1"># Response</span>
<span class="na">success</span><span class="pi">:</span> <span class="s">bool</span>
<span class="na">message</span><span class="pi">:</span> <span class="s">string</span>
</code></pre></div></div> <h4 id="modcubeget_pid_params"> <a href="#modcubeget_pid_params" class="anchor-heading" aria-labelledby="modcubeget_pid_params"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <code class="language-plaintext highlighter-rouge">/modcube/get_pid_params</code> </h4> <p><strong>Type</strong>: <code class="language-plaintext highlighter-rouge">modcube_msgs/GetPIDParams</code><br /> <strong>Description</strong>: Get current PID controller parameters</p> <h4 id="modcubeset_thruster_config"> <a href="#modcubeset_thruster_config" class="anchor-heading" aria-labelledby="modcubeset_thruster_config"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <code class="language-plaintext highlighter-rouge">/modcube/set_thruster_config</code> </h4> <p><strong>Type</strong>: <code class="language-plaintext highlighter-rouge">modcube_msgs/SetThrusterManagerConfig</code><br /> <strong>Description</strong>: Configure thruster manager</p> <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Request</span>
<span class="na">thruster_ids</span><span class="pi">:</span> <span class="s">int32[]</span>
<span class="na">max_thrust</span><span class="pi">:</span> <span class="s">float64[]</span>
<span class="na">thruster_topic_prefix</span><span class="pi">:</span> <span class="s">string</span>
<span class="na">thruster_topic_suffix</span><span class="pi">:</span> <span class="s">string</span>
<span class="na">thruster_frame_base</span><span class="pi">:</span> <span class="s">string</span>
<span class="na">max_thrust_pc</span><span class="pi">:</span> <span class="s">float64</span>

<span class="c1"># Response</span>
<span class="na">success</span><span class="pi">:</span> <span class="s">bool</span>
<span class="na">message</span><span class="pi">:</span> <span class="s">string</span>
</code></pre></div></div> <h3 id="mission-services"> <a href="#mission-services" class="anchor-heading" aria-labelledby="mission-services"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Mission Services </h3> <h4 id="modcubemission_control"> <a href="#modcubemission_control" class="anchor-heading" aria-labelledby="modcubemission_control"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <code class="language-plaintext highlighter-rouge">/modcube/mission_control</code> </h4> <p><strong>Type</strong>: <code class="language-plaintext highlighter-rouge">modcube_msgs/MissionControl</code><br /> <strong>Description</strong>: Control mission execution</p> <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Request</span>
<span class="na">command</span><span class="pi">:</span> <span class="s">string</span>        <span class="c1"># 'start', 'stop', 'pause', 'resume'</span>
<span class="na">mission_type</span><span class="pi">:</span> <span class="s">string</span>   <span class="c1"># Mission type identifier</span>
<span class="na">parameters</span><span class="pi">:</span> <span class="s">string[]</span>   <span class="c1"># Mission-specific parameters</span>

<span class="c1"># Response</span>
<span class="na">success</span><span class="pi">:</span> <span class="s">bool</span>
<span class="na">message</span><span class="pi">:</span> <span class="s">string</span>
<span class="na">mission_id</span><span class="pi">:</span> <span class="s">string</span>
</code></pre></div></div> <h3 id="state-estimation-services"> <a href="#state-estimation-services" class="anchor-heading" aria-labelledby="state-estimation-services"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> State Estimation Services </h3> <h4 id="modcubestate_estimatorreset"> <a href="#modcubestate_estimatorreset" class="anchor-heading" aria-labelledby="modcubestate_estimatorreset"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <code class="language-plaintext highlighter-rouge">/modcube/state_estimator/reset</code> </h4> <p><strong>Type</strong>: <code class="language-plaintext highlighter-rouge">modcube_msgs/ResetStateEstimator</code><br /> <strong>Description</strong>: Reset state estimator with optional initial state</p> <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Request</span>
<span class="na">initial_pose</span><span class="pi">:</span>
  <span class="na">position</span><span class="pi">:</span> <span class="pi">{</span><span class="nv">x</span><span class="pi">:</span> <span class="nv">float64</span><span class="pi">,</span> <span class="nv">y</span><span class="pi">:</span> <span class="nv">float64</span><span class="pi">,</span> <span class="nv">z</span><span class="pi">:</span> <span class="nv">float64</span><span class="pi">}</span>
  <span class="na">orientation</span><span class="pi">:</span> <span class="pi">{</span><span class="nv">x</span><span class="pi">:</span> <span class="nv">float64</span><span class="pi">,</span> <span class="nv">y</span><span class="pi">:</span> <span class="nv">float64</span><span class="pi">,</span> <span class="nv">z</span><span class="pi">:</span> <span class="nv">float64</span><span class="pi">,</span> <span class="nv">w</span><span class="pi">:</span> <span class="nv">float64</span><span class="pi">}</span>
<span class="na">initial_velocity</span><span class="pi">:</span>
  <span class="na">linear</span><span class="pi">:</span> <span class="pi">{</span><span class="nv">x</span><span class="pi">:</span> <span class="nv">float64</span><span class="pi">,</span> <span class="nv">y</span><span class="pi">:</span> <span class="nv">float64</span><span class="pi">,</span> <span class="nv">z</span><span class="pi">:</span> <span class="nv">float64</span><span class="pi">}</span>
  <span class="na">angular</span><span class="pi">:</span> <span class="pi">{</span><span class="nv">x</span><span class="pi">:</span> <span class="nv">float64</span><span class="pi">,</span> <span class="nv">y</span><span class="pi">:</span> <span class="nv">float64</span><span class="pi">,</span> <span class="nv">z</span><span class="pi">:</span> <span class="nv">float64</span><span class="pi">}</span>
<span class="na">reset_covariance</span><span class="pi">:</span> <span class="s">bool</span>

<span class="c1"># Response</span>
<span class="na">success</span><span class="pi">:</span> <span class="s">bool</span>
<span class="na">message</span><span class="pi">:</span> <span class="s">string</span>
</code></pre></div></div> <h4 id="modcubestate_estimatorset_sensor_config"> <a href="#modcubestate_estimatorset_sensor_config" class="anchor-heading" aria-labelledby="modcubestate_estimatorset_sensor_config"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <code class="language-plaintext highlighter-rouge">/modcube/state_estimator/set_sensor_config</code> </h4> <p><strong>Type</strong>: <code class="language-plaintext highlighter-rouge">modcube_msgs/SetSensorConfig</code><br /> <strong>Description</strong>: Configure sensor parameters for state estimation</p> <h3 id="trajectory-generation-services"> <a href="#trajectory-generation-services" class="anchor-heading" aria-labelledby="trajectory-generation-services"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Trajectory Generation Services </h3> <h4 id="modcubetrajectorygenerate"> <a href="#modcubetrajectorygenerate" class="anchor-heading" aria-labelledby="modcubetrajectorygenerate"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <code class="language-plaintext highlighter-rouge">/modcube/trajectory/generate</code> </h4> <p><strong>Type</strong>: <code class="language-plaintext highlighter-rouge">modcube_msgs/GenerateTrajectory</code><br /> <strong>Description</strong>: Generate optimal trajectory between waypoints</p> <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Request</span>
<span class="na">waypoints</span><span class="pi">:</span> <span class="s">geometry_msgs/PoseStamped[]</span>
<span class="na">start_velocity</span><span class="pi">:</span> <span class="s">geometry_msgs/Twist</span>
<span class="na">end_velocity</span><span class="pi">:</span> <span class="s">geometry_msgs/Twist</span>
<span class="na">aggressiveness</span><span class="pi">:</span> <span class="s">float64</span>  <span class="c1"># 0.0 to 1.0</span>
<span class="na">max_velocity</span><span class="pi">:</span> <span class="s">float64</span>
<span class="na">max_acceleration</span><span class="pi">:</span> <span class="s">float64</span>

<span class="c1"># Response</span>
<span class="na">success</span><span class="pi">:</span> <span class="s">bool</span>
<span class="na">trajectory</span><span class="pi">:</span> <span class="s">nav_msgs/Path</span>
<span class="na">total_time</span><span class="pi">:</span> <span class="s">float64</span>
<span class="na">total_distance</span><span class="pi">:</span> <span class="s">float64</span>
<span class="na">average_speed</span><span class="pi">:</span> <span class="s">float64</span>
</code></pre></div></div> <h4 id="modcubetrajectoryget_target"> <a href="#modcubetrajectoryget_target" class="anchor-heading" aria-labelledby="modcubetrajectoryget_target"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <code class="language-plaintext highlighter-rouge">/modcube/trajectory/get_target</code> </h4> <p><strong>Type</strong>: <code class="language-plaintext highlighter-rouge">modcube_msgs/GetTrajectoryTarget</code><br /> <strong>Description</strong>: Get current trajectory target at specified time</p> <h3 id="dynamic-parameter-services"> <a href="#dynamic-parameter-services" class="anchor-heading" aria-labelledby="dynamic-parameter-services"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Dynamic Parameter Services </h3> <h4 id="modcubetune_pid_planner"> <a href="#modcubetune_pid_planner" class="anchor-heading" aria-labelledby="modcubetune_pid_planner"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <code class="language-plaintext highlighter-rouge">/modcube/tune_pid_planner</code> </h4> <p><strong>Type</strong>: <code class="language-plaintext highlighter-rouge">modcube_msgs/TunePIDPlanner</code><br /> <strong>Description</strong>: Dynamically tune PID planner parameters</p> <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Request</span>
<span class="na">axis</span><span class="pi">:</span> <span class="s">string</span>  <span class="c1"># 'x', 'y', 'z', 'roll', 'pitch', 'yaw'</span>
<span class="na">kp</span><span class="pi">:</span> <span class="s">float64</span>
<span class="na">ki</span><span class="pi">:</span> <span class="s">float64</span>
<span class="na">kd</span><span class="pi">:</span> <span class="s">float64</span>
<span class="na">tau</span><span class="pi">:</span> <span class="s">float64</span>
<span class="na">limit</span><span class="pi">:</span> <span class="s">float64</span>

<span class="c1"># Response</span>
<span class="na">success</span><span class="pi">:</span> <span class="s">bool</span>
<span class="na">message</span><span class="pi">:</span> <span class="s">string</span>
</code></pre></div></div> <h4 id="modcubetune_dynamics"> <a href="#modcubetune_dynamics" class="anchor-heading" aria-labelledby="modcubetune_dynamics"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <code class="language-plaintext highlighter-rouge">/modcube/tune_dynamics</code> </h4> <p><strong>Type</strong>: <code class="language-plaintext highlighter-rouge">modcube_msgs/TuneDynamics</code><br /> <strong>Description</strong>: Tune vehicle dynamics parameters</p> <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Request</span>
<span class="na">mass</span><span class="pi">:</span> <span class="s">float64</span>
<span class="na">volume</span><span class="pi">:</span> <span class="s">float64</span>
<span class="na">water_density</span><span class="pi">:</span> <span class="s">float64</span>
<span class="na">center_of_gravity</span><span class="pi">:</span> <span class="s">geometry_msgs/Vector3</span>
<span class="na">center_of_buoyancy</span><span class="pi">:</span> <span class="s">geometry_msgs/Vector3</span>
<span class="na">moments_of_inertia</span><span class="pi">:</span> <span class="s">float64[6]</span>  <span class="c1"># [Ixx, Iyy, Izz, Ixy, Ixz, Iyz]</span>
<span class="na">linear_damping</span><span class="pi">:</span> <span class="s">float64[6]</span>
<span class="na">quadratic_damping</span><span class="pi">:</span> <span class="s">float64[6]</span>
<span class="na">added_mass</span><span class="pi">:</span> <span class="s">float64[36]</span>  <span class="c1"># 6x6 matrix</span>

<span class="c1"># Response</span>
<span class="na">success</span><span class="pi">:</span> <span class="s">bool</span>
<span class="na">message</span><span class="pi">:</span> <span class="s">string</span>
</code></pre></div></div> <h3 id="diagnostic-services"> <a href="#diagnostic-services" class="anchor-heading" aria-labelledby="diagnostic-services"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Diagnostic Services </h3> <h4 id="modcubeget_system_status"> <a href="#modcubeget_system_status" class="anchor-heading" aria-labelledby="modcubeget_system_status"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <code class="language-plaintext highlighter-rouge">/modcube/get_system_status</code> </h4> <p><strong>Type</strong>: <code class="language-plaintext highlighter-rouge">modcube_msgs/GetSystemStatus</code><br /> <strong>Description</strong>: Get comprehensive system status</p> <h4 id="modcubetest_thrusters"> <a href="#modcubetest_thrusters" class="anchor-heading" aria-labelledby="modcubetest_thrusters"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <code class="language-plaintext highlighter-rouge">/modcube/test_thrusters</code> </h4> <p><strong>Type</strong>: <code class="language-plaintext highlighter-rouge">modcube_msgs/TestThrusters</code><br /> <strong>Description</strong>: Test individual thrusters</p> <h4 id="modcubecalibrate_sensors"> <a href="#modcubecalibrate_sensors" class="anchor-heading" aria-labelledby="modcubecalibrate_sensors"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <code class="language-plaintext highlighter-rouge">/modcube/calibrate_sensors</code> </h4> <p><strong>Type</strong>: <code class="language-plaintext highlighter-rouge">modcube_msgs/CalibrateSensors</code><br /> <strong>Description</strong>: Perform sensor calibration procedures</p> <h2 id="message-definitions"> <a href="#message-definitions" class="anchor-heading" aria-labelledby="message-definitions"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Message Definitions </h2> <h3 id="core-messages"> <a href="#core-messages" class="anchor-heading" aria-labelledby="core-messages"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Core Messages </h3> <h4 id="modcube_msgscontrollercommand"> <a href="#modcube_msgscontrollercommand" class="anchor-heading" aria-labelledby="modcube_msgscontrollercommand"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <code class="language-plaintext highlighter-rouge">modcube_msgs/ControllerCommand</code> </h4> <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s">std_msgs/Header header</span>
<span class="s">int32 mode</span>                    <span class="c1"># 1=position, 2=velocity, 3=acceleration</span>
<span class="s">geometry_msgs/Pose setpoint_pose</span>
<span class="s">geometry_msgs/Twist setpoint_twist</span>
<span class="s">geometry_msgs/Accel setpoint_accel</span>
<span class="s">bool enable_position_hold</span>
<span class="s">bool enable_depth_hold</span>
<span class="s">bool enable_heading_hold</span>
<span class="s">float64 timeout</span>              <span class="c1"># Command timeout in seconds</span>
</code></pre></div></div> <h4 id="modcube_msgsnavigationstate"> <a href="#modcube_msgsnavigationstate" class="anchor-heading" aria-labelledby="modcube_msgsnavigationstate"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <code class="language-plaintext highlighter-rouge">modcube_msgs/NavigationState</code> </h4> <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s">std_msgs/Header header</span>
<span class="s">geometry_msgs/PoseWithCovariance pose</span>
<span class="s">geometry_msgs/TwistWithCovariance twist</span>
<span class="s">geometry_msgs/AccelWithCovariance accel</span>
<span class="s">geometry_msgs/Vector3 euler_angles</span>     <span class="c1"># [roll, pitch, yaw]</span>
<span class="s">geometry_msgs/Vector3 euler_rates</span>      <span class="c1"># [roll_rate, pitch_rate, yaw_rate]</span>
<span class="s">geometry_msgs/Vector3 euler_accels</span>     <span class="c1"># [roll_accel, pitch_accel, yaw_accel]</span>
<span class="s">float64 depth</span>
<span class="s">float64 altitude</span>
<span class="s">bool is_valid</span>
<span class="s">float64 timestamp</span>
</code></pre></div></div> <h4 id="modcube_msgsthrustercommand"> <a href="#modcube_msgsthrustercommand" class="anchor-heading" aria-labelledby="modcube_msgsthrustercommand"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <code class="language-plaintext highlighter-rouge">modcube_msgs/ThrusterCommand</code> </h4> <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s">std_msgs/Header header</span>
<span class="s">float64[14] thrusters</span>        <span class="c1"># Normalized thrust values [-1.0, 1.0]</span>
<span class="s">float64[14] thrust_forces</span>    <span class="c1"># Actual thrust forces in Newtons</span>
<span class="s">bool emergency_stop</span>
<span class="s">float64 max_thrust_percentage</span> <span class="c1"># Global thrust scaling [0.0, 1.0]</span>
</code></pre></div></div> <h3 id="sensor-messages"> <a href="#sensor-messages" class="anchor-heading" aria-labelledby="sensor-messages"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Sensor Messages </h3> <h4 id="modcube_msgsdvldata"> <a href="#modcube_msgsdvldata" class="anchor-heading" aria-labelledby="modcube_msgsdvldata"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <code class="language-plaintext highlighter-rouge">modcube_msgs/DVLData</code> </h4> <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s">std_msgs/Header header</span>
<span class="s">geometry_msgs/Vector3 velocity</span>
<span class="s">float64 altitude</span>
<span class="s">float64[4] beam_ranges</span>
<span class="s">float64[4] beam_velocities</span>
<span class="s">int32 status</span>
</code></pre></div></div> <h4 id="modcube_msgsfluiddepth"> <a href="#modcube_msgsfluiddepth" class="anchor-heading" aria-labelledby="modcube_msgsfluiddepth"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <code class="language-plaintext highlighter-rouge">modcube_msgs/FluidDepth</code> </h4> <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s">std_msgs/Header header</span>
<span class="s">float64 depth</span>
<span class="s">float64 pressure</span>
<span class="s">float64 temperature</span>
</code></pre></div></div> <h4 id="modcube_msgssonarpulse"> <a href="#modcube_msgssonarpulse" class="anchor-heading" aria-labelledby="modcube_msgssonarpulse"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <code class="language-plaintext highlighter-rouge">modcube_msgs/SonarPulse</code> </h4> <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s">std_msgs/Header header</span>
<span class="s">float64 range</span>
<span class="s">float64 intensity</span>
<span class="s">float64 angle</span>
</code></pre></div></div> <h3 id="detection-messages"> <a href="#detection-messages" class="anchor-heading" aria-labelledby="detection-messages"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Detection Messages </h3> <h4 id="modcube_msgsapriltagdetection"> <a href="#modcube_msgsapriltagdetection" class="anchor-heading" aria-labelledby="modcube_msgsapriltagdetection"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <code class="language-plaintext highlighter-rouge">modcube_msgs/AprilTagDetection</code> </h4> <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s">std_msgs/Header header</span>
<span class="s">int32 id</span>
<span class="s">geometry_msgs/PoseWithCovariance pose</span>
<span class="s">float64 size</span>
<span class="s">float64 confidence</span>
</code></pre></div></div> <h4 id="modcube_msgsgatedetection"> <a href="#modcube_msgsgatedetection" class="anchor-heading" aria-labelledby="modcube_msgsgatedetection"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <code class="language-plaintext highlighter-rouge">modcube_msgs/GateDetection</code> </h4> <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s">std_msgs/Header header</span>
<span class="s">geometry_msgs/Point[] corners</span>
<span class="s">float64 width</span>
<span class="s">float64 height</span>
<span class="s">float64 confidence</span>
</code></pre></div></div> <h3 id="system-messages"> <a href="#system-messages" class="anchor-heading" aria-labelledby="system-messages"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> System Messages </h3> <h4 id="modcube_msgsalarm"> <a href="#modcube_msgsalarm" class="anchor-heading" aria-labelledby="modcube_msgsalarm"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <code class="language-plaintext highlighter-rouge">modcube_msgs/Alarm</code> </h4> <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s">std_msgs/Header header</span>
<span class="s">string alarm_name</span>
<span class="s">int32 severity</span>      <span class="c1"># 0=info, 1=warning, 2=error, 3=critical</span>
<span class="s">string description</span>
<span class="s">bool active</span>
</code></pre></div></div> <h4 id="modcube_msgsbatterystatus"> <a href="#modcube_msgsbatterystatus" class="anchor-heading" aria-labelledby="modcube_msgsbatterystatus"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <code class="language-plaintext highlighter-rouge">modcube_msgs/BatteryStatus</code> </h4> <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s">std_msgs/Header header</span>
<span class="s">float64 voltage</span>
<span class="s">float64 current</span>
<span class="s">float64 charge_percentage</span>
<span class="s">float64 temperature</span>
<span class="s">int32 status</span>        <span class="c1"># 0=unknown, 1=charging, 2=discharging, 3=full</span>
</code></pre></div></div> <h3 id="debug-and-analysis-messages"> <a href="#debug-and-analysis-messages" class="anchor-heading" aria-labelledby="debug-and-analysis-messages"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Debug and Analysis Messages </h3> <h4 id="modcube_msgspiddebug"> <a href="#modcube_msgspiddebug" class="anchor-heading" aria-labelledby="modcube_msgspiddebug"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <code class="language-plaintext highlighter-rouge">modcube_msgs/PIDDebug</code> </h4> <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s">std_msgs/Header header</span>
<span class="s">string axis</span>                  <span class="c1"># 'x', 'y', 'z', 'roll', 'pitch', 'yaw'</span>
<span class="s">float64 setpoint</span>
<span class="s">float64 process_variable</span>
<span class="s">float64 error</span>
<span class="s">float64 error_integral</span>
<span class="s">float64 error_derivative</span>
<span class="s">float64 proportional_term</span>
<span class="s">float64 integral_term</span>
<span class="s">float64 derivative_term</span>
<span class="s">float64 output</span>
<span class="s">float64 output_limited</span>
<span class="s">float64 kp</span>
<span class="s">float64 ki</span>
<span class="s">float64 kd</span>
<span class="s">float64 tau</span>
<span class="s">float64 limit</span>
</code></pre></div></div> <h4 id="modcube_msgsekfdebug"> <a href="#modcube_msgsekfdebug" class="anchor-heading" aria-labelledby="modcube_msgsekfdebug"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <code class="language-plaintext highlighter-rouge">modcube_msgs/EKFDebug</code> </h4> <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s">std_msgs/Header header</span>
<span class="s">float64[15] state_vector</span>     <span class="c1"># [pos_x, pos_y, pos_z, vel_x, vel_y, vel_z, </span>
                             <span class="c1">#  acc_x, acc_y, acc_z, roll, pitch, yaw, </span>
                             <span class="c1">#  ang_vel_x, ang_vel_y, ang_vel_z]</span>
<span class="s">float64[225] covariance</span>      <span class="c1"># 15x15 covariance matrix (row-major)</span>
<span class="s">float64[15] innovation</span>       <span class="c1"># Innovation vector</span>
<span class="s">float64[225] innovation_cov</span>  <span class="c1"># Innovation covariance</span>
<span class="s">string last_update_sensor</span>    <span class="c1"># Last sensor that updated the filter</span>
<span class="s">float64 mahalanobis_distance</span> <span class="c1"># Mahalanobis distance for outlier detection</span>
<span class="s">bool is_converged</span>
</code></pre></div></div> <h4 id="modcube_msgsthrusterallocation"> <a href="#modcube_msgsthrusterallocation" class="anchor-heading" aria-labelledby="modcube_msgsthrusterallocation"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <code class="language-plaintext highlighter-rouge">modcube_msgs/ThrusterAllocation</code> </h4> <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s">std_msgs/Header header</span>
<span class="s">geometry_msgs/Wrench desired_wrench</span>
<span class="s">float64[14] allocated_thrusts</span>
<span class="s">float64[6] achieved_wrench</span>   <span class="c1"># [Fx, Fy, Fz, Tx, Ty, Tz]</span>
<span class="s">float64 allocation_error</span>     <span class="c1"># Norm of (desired - achieved)</span>
<span class="s">float64[14] saturation_flags</span> <span class="c1"># 1.0 if thruster is saturated, 0.0 otherwise</span>
</code></pre></div></div> <h3 id="trajectory-messages"> <a href="#trajectory-messages" class="anchor-heading" aria-labelledby="trajectory-messages"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Trajectory Messages </h3> <h4 id="modcube_msgstrajectorypoint"> <a href="#modcube_msgstrajectorypoint" class="anchor-heading" aria-labelledby="modcube_msgstrajectorypoint"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <code class="language-plaintext highlighter-rouge">modcube_msgs/TrajectoryPoint</code> </h4> <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s">float64 time_from_start</span>
<span class="s">geometry_msgs/Pose pose</span>
<span class="s">geometry_msgs/Twist velocity</span>
<span class="s">geometry_msgs/Accel acceleration</span>
</code></pre></div></div> <h4 id="modcube_msgsoptimaltrajectory"> <a href="#modcube_msgsoptimaltrajectory" class="anchor-heading" aria-labelledby="modcube_msgsoptimaltrajectory"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <code class="language-plaintext highlighter-rouge">modcube_msgs/OptimalTrajectory</code> </h4> <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s">std_msgs/Header header</span>
<span class="s">modcube_msgs/TrajectoryPoint[] points</span>
<span class="s">float64 total_time</span>
<span class="s">float64 total_distance</span>
<span class="s">float64 average_speed</span>
<span class="s">float64 max_velocity</span>
<span class="s">float64 max_acceleration</span>
<span class="s">float64 aggressiveness</span>
<span class="s">string optimization_method</span>   <span class="c1"># 'minimum_snap', 'minimum_jerk', etc.</span>
</code></pre></div></div> <h2 id="python-apis"> <a href="#python-apis" class="anchor-heading" aria-labelledby="python-apis"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Python APIs </h2> <h3 id="controller-api"> <a href="#controller-api" class="anchor-heading" aria-labelledby="controller-api"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Controller API </h3> <h4 id="modcube_commoncontrollerspidcontroller"> <a href="#modcube_commoncontrollerspidcontroller" class="anchor-heading" aria-labelledby="modcube_commoncontrollerspidcontroller"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <code class="language-plaintext highlighter-rouge">modcube_common.controllers.PIDController</code> </h4> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">PIDController</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">namespace</span><span class="o">=</span><span class="sh">'</span><span class="s">/modcube</span><span class="sh">'</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Initialize PID controller.
        
        Args:
            namespace (str): ROS namespace for topics and services
        </span><span class="sh">"""</span>
    
    <span class="k">def</span> <span class="nf">set_gains</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">pos_gains</span><span class="p">,</span> <span class="n">orient_gains</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Set PID gains.
        
        Args:
            pos_gains (dict): Position gains {</span><span class="sh">'</span><span class="s">p</span><span class="sh">'</span><span class="s">: [x,y,z], </span><span class="sh">'</span><span class="s">i</span><span class="sh">'</span><span class="s">: [x,y,z], </span><span class="sh">'</span><span class="s">d</span><span class="sh">'</span><span class="s">: [x,y,z]}
            orient_gains (dict): Orientation gains {</span><span class="sh">'</span><span class="s">p</span><span class="sh">'</span><span class="s">: [r,p,y], </span><span class="sh">'</span><span class="s">i</span><span class="sh">'</span><span class="s">: [r,p,y], </span><span class="sh">'</span><span class="s">d</span><span class="sh">'</span><span class="s">: [r,p,y]}
        
        Returns:
            bool: Success status
        </span><span class="sh">"""</span>
    
    <span class="k">def</span> <span class="nf">compute_wrench</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">current_state</span><span class="p">,</span> <span class="n">desired_state</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Compute control wrench.
        
        Args:
            current_state (NavState): Current vehicle state
            desired_state (ControllerCommand): Desired state
        
        Returns:
            geometry_msgs/Wrench: Control wrench
        </span><span class="sh">"""</span>
    
    <span class="k">def</span> <span class="nf">enable</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Enable controller.</span><span class="sh">"""</span>
    
    <span class="k">def</span> <span class="nf">disable</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Disable controller.</span><span class="sh">"""</span>
</code></pre></div></div> <h4 id="example-usage"> <a href="#example-usage" class="anchor-heading" aria-labelledby="example-usage"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Example Usage </h4> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">rospy</span>
<span class="kn">from</span> <span class="n">modcube_common.controllers</span> <span class="kn">import</span> <span class="n">PIDController</span>
<span class="kn">from</span> <span class="n">modcube_msgs.msg</span> <span class="kn">import</span> <span class="n">ControllerCommand</span>
<span class="kn">from</span> <span class="n">geometry_msgs.msg</span> <span class="kn">import</span> <span class="n">Point</span><span class="p">,</span> <span class="n">Quaternion</span>

<span class="c1"># Initialize controller
</span><span class="n">controller</span> <span class="o">=</span> <span class="nc">PIDController</span><span class="p">(</span><span class="n">namespace</span><span class="o">=</span><span class="sh">'</span><span class="s">/modcube</span><span class="sh">'</span><span class="p">)</span>

<span class="c1"># Set gains
</span><span class="n">pos_gains</span> <span class="o">=</span> <span class="p">{</span><span class="sh">'</span><span class="s">p</span><span class="sh">'</span><span class="p">:</span> <span class="p">[</span><span class="mf">10.0</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">],</span> <span class="sh">'</span><span class="s">i</span><span class="sh">'</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">],</span> <span class="sh">'</span><span class="s">d</span><span class="sh">'</span><span class="p">:</span> <span class="p">[</span><span class="mf">5.0</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">]}</span>
<span class="n">orient_gains</span> <span class="o">=</span> <span class="p">{</span><span class="sh">'</span><span class="s">p</span><span class="sh">'</span><span class="p">:</span> <span class="p">[</span><span class="mf">20.0</span><span class="p">,</span> <span class="mf">20.0</span><span class="p">,</span> <span class="mf">20.0</span><span class="p">],</span> <span class="sh">'</span><span class="s">i</span><span class="sh">'</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">],</span> <span class="sh">'</span><span class="s">d</span><span class="sh">'</span><span class="p">:</span> <span class="p">[</span><span class="mf">8.0</span><span class="p">,</span> <span class="mf">8.0</span><span class="p">,</span> <span class="mf">8.0</span><span class="p">]}</span>
<span class="n">controller</span><span class="p">.</span><span class="nf">set_gains</span><span class="p">(</span><span class="n">pos_gains</span><span class="p">,</span> <span class="n">orient_gains</span><span class="p">)</span>

<span class="c1"># Enable controller
</span><span class="n">controller</span><span class="p">.</span><span class="nf">enable</span><span class="p">()</span>

<span class="c1"># Send command
</span><span class="n">cmd</span> <span class="o">=</span> <span class="nc">ControllerCommand</span><span class="p">()</span>
<span class="n">cmd</span><span class="p">.</span><span class="n">mode</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># Position control
</span><span class="n">cmd</span><span class="p">.</span><span class="n">setpoint</span><span class="p">.</span><span class="n">position</span> <span class="o">=</span> <span class="nc">Point</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">)</span>
<span class="n">cmd</span><span class="p">.</span><span class="n">setpoint</span><span class="p">.</span><span class="n">orientation</span> <span class="o">=</span> <span class="nc">Quaternion</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

<span class="n">controller</span><span class="p">.</span><span class="nf">send_command</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
</code></pre></div></div> <h3 id="motion-client-api"> <a href="#motion-client-api" class="anchor-heading" aria-labelledby="motion-client-api"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Motion Client API </h3> <h4 id="modcube_commonmotionmotionclient"> <a href="#modcube_commonmotionmotionclient" class="anchor-heading" aria-labelledby="modcube_commonmotionmotionclient"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <code class="language-plaintext highlighter-rouge">modcube_common.motion.MotionClient</code> </h4> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">MotionClient</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">namespace</span><span class="o">=</span><span class="sh">'</span><span class="s">/modcube</span><span class="sh">'</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Initialize motion client.</span><span class="sh">"""</span>
    
    <span class="k">def</span> <span class="nf">goto_position</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mf">30.0</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Move to specified position.
        
        Args:
            x, y, z (float): Target position
            timeout (float): Maximum time to reach target
        
        Returns:
            bool: Success status
        </span><span class="sh">"""</span>
    
    <span class="k">def</span> <span class="nf">goto_pose</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">pose</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mf">30.0</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Move to specified pose.
        
        Args:
            pose (geometry_msgs/Pose): Target pose
            timeout (float): Maximum time to reach target
        
        Returns:
            bool: Success status
        </span><span class="sh">"""</span>
    
    <span class="k">def</span> <span class="nf">follow_trajectory</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">trajectory</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Follow a trajectory.
        
        Args:
            trajectory (nav_msgs/Path): Trajectory to follow
        
        Returns:
            bool: Success status
        </span><span class="sh">"""</span>
    
    <span class="k">def</span> <span class="nf">stop</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Stop all motion.</span><span class="sh">"""</span>
    
    <span class="k">def</span> <span class="nf">get_current_pose</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Get current vehicle pose.
        
        Returns:
            geometry_msgs/Pose: Current pose
        </span><span class="sh">"""</span>
</code></pre></div></div> <h3 id="mission-manager-api"> <a href="#mission-manager-api" class="anchor-heading" aria-labelledby="mission-manager-api"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Mission Manager API </h3> <h4 id="modcube_missionmissionmanager"> <a href="#modcube_missionmissionmanager" class="anchor-heading" aria-labelledby="modcube_missionmissionmanager"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <code class="language-plaintext highlighter-rouge">modcube_mission.MissionManager</code> </h4> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">MissionManager</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Initialize mission manager.</span><span class="sh">"""</span>
    
    <span class="k">def</span> <span class="nf">start_mission</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">mission_type</span><span class="p">,</span> <span class="n">parameters</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Start a mission.
        
        Args:
            mission_type (str): Type of mission
            parameters (dict): Mission parameters
        
        Returns:
            str: Mission ID
        </span><span class="sh">"""</span>
    
    <span class="k">def</span> <span class="nf">stop_mission</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">mission_id</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Stop a running mission.
        
        Args:
            mission_id (str): Mission ID to stop
        
        Returns:
            bool: Success status
        </span><span class="sh">"""</span>
    
    <span class="k">def</span> <span class="nf">get_mission_status</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">mission_id</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Get mission status.
        
        Args:
            mission_id (str): Mission ID
        
        Returns:
            dict: Mission status information
        </span><span class="sh">"""</span>
    
    <span class="k">def</span> <span class="nf">register_mission_type</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">mission_type</span><span class="p">,</span> <span class="n">mission_class</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Register a new mission type.
        
        Args:
            mission_type (str): Mission type identifier
            mission_class (class): Mission implementation class
        </span><span class="sh">"""</span>
</code></pre></div></div> <h3 id="state-estimation-api"> <a href="#state-estimation-api" class="anchor-heading" aria-labelledby="state-estimation-api"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> State Estimation API </h3> <h4 id="modcube_commonstate_estimationstateestimator"> <a href="#modcube_commonstate_estimationstateestimator" class="anchor-heading" aria-labelledby="modcube_commonstate_estimationstateestimator"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <code class="language-plaintext highlighter-rouge">modcube_common.state_estimation.StateEstimator</code> </h4> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">StateEstimator</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">sensors</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Initialize state estimator.
        
        Args:
            sensors (list): List of sensor configurations
        </span><span class="sh">"""</span>
    
    <span class="k">def</span> <span class="nf">add_sensor</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">sensor_type</span><span class="p">,</span> <span class="n">topic</span><span class="p">,</span> <span class="n">frame_id</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Add a sensor to the estimator.
        
        Args:
            sensor_type (str): Type of sensor (</span><span class="sh">'</span><span class="s">imu</span><span class="sh">'</span><span class="s">, </span><span class="sh">'</span><span class="s">dvl</span><span class="sh">'</span><span class="s">, </span><span class="sh">'</span><span class="s">depth</span><span class="sh">'</span><span class="s">, etc.)
            topic (str): ROS topic for sensor data
            frame_id (str): Sensor frame ID
        </span><span class="sh">"""</span>
    
    <span class="k">def</span> <span class="nf">get_state</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Get current estimated state.
        
        Returns:
            NavState: Current navigation state
        </span><span class="sh">"""</span>
    
    <span class="k">def</span> <span class="nf">reset_state</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">initial_state</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Reset estimator state.
        
        Args:
            initial_state (NavState): Initial state (optional)
        </span><span class="sh">"""</span>

<span class="c1">## C++ APIs
</span>
<span class="c1">### Extended Kalman Filter API
</span>
<span class="c1">#### `modcube_common::Ekf`
</span>
<span class="sb">``</span><span class="err">`</span><span class="n">cpp</span>
<span class="c1">#include &lt;modcube_common/ekf.h&gt;
</span>
<span class="n">namespace</span> <span class="n">modcube_common</span> <span class="p">{</span>

<span class="k">class</span> <span class="nc">Ekf</span> <span class="p">{</span>
<span class="n">public</span><span class="p">:</span>
    <span class="o">/**</span>
     <span class="o">*</span> <span class="nd">@brief</span> <span class="n">Constructor</span>
     <span class="o">*/</span>
    <span class="nc">Ekf</span><span class="p">();</span>
    
    <span class="o">/**</span>
     <span class="o">*</span> <span class="nd">@brief</span> <span class="n">Destructor</span>
     <span class="o">*/</span>
    <span class="o">~</span><span class="nc">Ekf</span><span class="p">();</span>
    
    <span class="o">/**</span>
     <span class="o">*</span> <span class="nd">@brief</span> <span class="n">Set</span> <span class="n">DVL</span> <span class="n">offset</span> <span class="k">from</span> <span class="n">vehicle</span> <span class="n">center</span>
     <span class="o">*</span> <span class="nd">@param</span> <span class="n">offset</span> <span class="n">DVL</span> <span class="n">offset</span> <span class="n">vector</span> <span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">]</span>
     <span class="o">*/</span>
    <span class="n">void</span> <span class="nf">setDvlOffset</span><span class="p">(</span><span class="n">const</span> <span class="n">Eigen</span><span class="p">::</span><span class="n">Vector3d</span><span class="o">&amp;</span> <span class="n">offset</span><span class="p">);</span>
    
    <span class="o">/**</span>
     <span class="o">*</span> <span class="nd">@brief</span> <span class="n">Set</span> <span class="n">process</span> <span class="n">noise</span> <span class="n">covariance</span>
     <span class="o">*</span> <span class="nd">@param</span> <span class="n">cov</span> <span class="n">Process</span> <span class="n">noise</span> <span class="n">covariance</span> <span class="nf">matrix </span><span class="p">(</span><span class="mi">15</span><span class="n">x15</span><span class="p">)</span>
     <span class="o">*/</span>
    <span class="n">void</span> <span class="nf">setProcessCovariance</span><span class="p">(</span><span class="n">const</span> <span class="n">Eigen</span><span class="p">::</span><span class="n">MatrixXd</span><span class="o">&amp;</span> <span class="n">cov</span><span class="p">);</span>
    
    <span class="o">/**</span>
     <span class="o">*</span> <span class="nd">@brief</span> <span class="n">Get</span> <span class="n">current</span> <span class="n">state</span> <span class="n">vector</span>
     <span class="o">*</span> <span class="nd">@return</span> <span class="n">State</span> <span class="n">vector</span> <span class="p">[</span><span class="n">pos</span><span class="p">,</span> <span class="n">vel</span><span class="p">,</span> <span class="n">acc</span><span class="p">,</span> <span class="n">euler</span><span class="p">,</span> <span class="n">ang_vel</span><span class="p">]</span>
     <span class="o">*/</span>
    <span class="n">Eigen</span><span class="p">::</span><span class="n">VectorXd</span> <span class="nf">getState</span><span class="p">()</span> <span class="n">const</span><span class="p">;</span>
    
    <span class="o">/**</span>
     <span class="o">*</span> <span class="nd">@brief</span> <span class="n">Set</span> <span class="n">state</span> <span class="n">vector</span>
     <span class="o">*</span> <span class="nd">@param</span> <span class="n">state</span> <span class="n">State</span> <span class="nf">vector </span><span class="p">(</span><span class="mi">15</span><span class="n">x1</span><span class="p">)</span>
     <span class="o">*/</span>
    <span class="n">void</span> <span class="nf">setState</span><span class="p">(</span><span class="n">const</span> <span class="n">Eigen</span><span class="p">::</span><span class="n">VectorXd</span><span class="o">&amp;</span> <span class="n">state</span><span class="p">);</span>
    
    <span class="o">/**</span>
     <span class="o">*</span> <span class="nd">@brief</span> <span class="n">Get</span> <span class="n">state</span> <span class="n">covariance</span> <span class="n">matrix</span>
     <span class="o">*</span> <span class="nd">@return</span> <span class="n">Covariance</span> <span class="nf">matrix </span><span class="p">(</span><span class="mi">15</span><span class="n">x15</span><span class="p">)</span>
     <span class="o">*/</span>
    <span class="n">Eigen</span><span class="p">::</span><span class="n">MatrixXd</span> <span class="nf">getCovariance</span><span class="p">()</span> <span class="n">const</span><span class="p">;</span>
    
    <span class="o">/**</span>
     <span class="o">*</span> <span class="nd">@brief</span> <span class="n">Set</span> <span class="n">state</span> <span class="n">covariance</span> <span class="n">matrix</span>
     <span class="o">*</span> <span class="nd">@param</span> <span class="n">cov</span> <span class="n">Covariance</span> <span class="nf">matrix </span><span class="p">(</span><span class="mi">15</span><span class="n">x15</span><span class="p">)</span>
     <span class="o">*/</span>
    <span class="n">void</span> <span class="nf">setCovariance</span><span class="p">(</span><span class="n">const</span> <span class="n">Eigen</span><span class="p">::</span><span class="n">MatrixXd</span><span class="o">&amp;</span> <span class="n">cov</span><span class="p">);</span>
    
    <span class="o">/**</span>
     <span class="o">*</span> <span class="nd">@brief</span> <span class="n">Process</span> <span class="n">IMU</span> <span class="n">measurement</span>
     <span class="o">*</span> <span class="nd">@param</span> <span class="n">imu_data</span> <span class="n">IMU</span> <span class="n">sensor</span> <span class="n">data</span>
     <span class="o">*</span> <span class="nd">@param</span> <span class="n">dt</span> <span class="n">Time</span> <span class="n">step</span>
     <span class="o">*/</span>
    <span class="n">void</span> <span class="nf">handleImuMeasurement</span><span class="p">(</span><span class="n">const</span> <span class="n">sensor_msgs</span><span class="p">::</span><span class="n">Imu</span><span class="o">&amp;</span> <span class="n">imu_data</span><span class="p">,</span> <span class="n">double</span> <span class="n">dt</span><span class="p">);</span>
    
    <span class="o">/**</span>
     <span class="o">*</span> <span class="nd">@brief</span> <span class="n">Process</span> <span class="n">DVL</span> <span class="n">measurement</span>
     <span class="o">*</span> <span class="nd">@param</span> <span class="n">dvl_data</span> <span class="n">DVL</span> <span class="n">sensor</span> <span class="n">data</span>
     <span class="o">*</span> <span class="nd">@param</span> <span class="n">dt</span> <span class="n">Time</span> <span class="n">step</span>
     <span class="o">*/</span>
    <span class="n">void</span> <span class="nf">handleDvlMeasurement</span><span class="p">(</span><span class="n">const</span> <span class="n">modcube_msgs</span><span class="p">::</span><span class="n">DVLData</span><span class="o">&amp;</span> <span class="n">dvl_data</span><span class="p">,</span> <span class="n">double</span> <span class="n">dt</span><span class="p">);</span>
    
    <span class="o">/**</span>
     <span class="o">*</span> <span class="nd">@brief</span> <span class="n">Process</span> <span class="n">depth</span> <span class="n">measurement</span>
     <span class="o">*</span> <span class="nd">@param</span> <span class="n">depth_data</span> <span class="n">Depth</span> <span class="n">sensor</span> <span class="n">data</span>
     <span class="o">*</span> <span class="nd">@param</span> <span class="n">dt</span> <span class="n">Time</span> <span class="n">step</span>
     <span class="o">*/</span>
    <span class="n">void</span> <span class="nf">handleDepthMeasurement</span><span class="p">(</span><span class="n">const</span> <span class="n">modcube_msgs</span><span class="p">::</span><span class="n">FluidDepth</span><span class="o">&amp;</span> <span class="n">depth_data</span><span class="p">,</span> <span class="n">double</span> <span class="n">dt</span><span class="p">);</span>
    
<span class="n">private</span><span class="p">:</span>
    <span class="o">/**</span>
     <span class="o">*</span> <span class="nd">@brief</span> <span class="n">Prediction</span> <span class="n">step</span> <span class="n">of</span> <span class="n">EKF</span>
     <span class="o">*</span> <span class="nd">@param</span> <span class="n">dt</span> <span class="n">Time</span> <span class="n">step</span>
     <span class="o">*/</span>
    <span class="n">void</span> <span class="nf">predict</span><span class="p">(</span><span class="n">double</span> <span class="n">dt</span><span class="p">);</span>
    
    <span class="o">/**</span>
     <span class="o">*</span> <span class="nd">@brief</span> <span class="n">Update</span> <span class="n">step</span> <span class="n">of</span> <span class="n">EKF</span>
     <span class="o">*</span> <span class="nd">@param</span> <span class="n">measurement</span> <span class="n">Measurement</span> <span class="n">vector</span>
     <span class="o">*</span> <span class="nd">@param</span> <span class="n">measurement_cov</span> <span class="n">Measurement</span> <span class="n">covariance</span>
     <span class="o">*</span> <span class="nd">@param</span> <span class="n">H</span> <span class="n">Measurement</span> <span class="n">Jacobian</span>
     <span class="o">*/</span>
    <span class="n">void</span> <span class="nf">update</span><span class="p">(</span><span class="n">const</span> <span class="n">Eigen</span><span class="p">::</span><span class="n">VectorXd</span><span class="o">&amp;</span> <span class="n">measurement</span><span class="p">,</span>
                <span class="n">const</span> <span class="n">Eigen</span><span class="p">::</span><span class="n">MatrixXd</span><span class="o">&amp;</span> <span class="n">measurement_cov</span><span class="p">,</span>
                <span class="n">const</span> <span class="n">Eigen</span><span class="p">::</span><span class="n">MatrixXd</span><span class="o">&amp;</span> <span class="n">H</span><span class="p">);</span>
    
    <span class="o">/**</span>
     <span class="o">*</span> <span class="nd">@brief</span> <span class="n">Extrapolate</span> <span class="n">state</span> <span class="n">forward</span> <span class="ow">in</span> <span class="n">time</span>
     <span class="o">*</span> <span class="nd">@param</span> <span class="n">state</span> <span class="n">Current</span> <span class="n">state</span>
     <span class="o">*</span> <span class="nd">@param</span> <span class="n">dt</span> <span class="n">Time</span> <span class="n">step</span>
     <span class="o">*</span> <span class="nd">@return</span> <span class="n">Extrapolated</span> <span class="n">state</span>
     <span class="o">*/</span>
    <span class="n">Eigen</span><span class="p">::</span><span class="n">VectorXd</span> <span class="nf">extrapolateState</span><span class="p">(</span><span class="n">const</span> <span class="n">Eigen</span><span class="p">::</span><span class="n">VectorXd</span><span class="o">&amp;</span> <span class="n">state</span><span class="p">,</span> <span class="n">double</span> <span class="n">dt</span><span class="p">);</span>
    
    <span class="o">/**</span>
     <span class="o">*</span> <span class="nd">@brief</span> <span class="n">Extrapolate</span> <span class="n">covariance</span> <span class="n">forward</span> <span class="ow">in</span> <span class="n">time</span>
     <span class="o">*</span> <span class="nd">@param</span> <span class="n">cov</span> <span class="n">Current</span> <span class="n">covariance</span>
     <span class="o">*</span> <span class="nd">@param</span> <span class="n">F</span> <span class="n">State</span> <span class="n">transition</span> <span class="n">Jacobian</span>
     <span class="o">*</span> <span class="nd">@param</span> <span class="n">Q</span> <span class="n">Process</span> <span class="n">noise</span> <span class="n">covariance</span>
     <span class="o">*</span> <span class="nd">@return</span> <span class="n">Extrapolated</span> <span class="n">covariance</span>
     <span class="o">*/</span>
    <span class="n">Eigen</span><span class="p">::</span><span class="n">MatrixXd</span> <span class="nf">extrapolateCovariance</span><span class="p">(</span><span class="n">const</span> <span class="n">Eigen</span><span class="p">::</span><span class="n">MatrixXd</span><span class="o">&amp;</span> <span class="n">cov</span><span class="p">,</span>
                                          <span class="n">const</span> <span class="n">Eigen</span><span class="p">::</span><span class="n">MatrixXd</span><span class="o">&amp;</span> <span class="n">F</span><span class="p">,</span>
                                          <span class="n">const</span> <span class="n">Eigen</span><span class="p">::</span><span class="n">MatrixXd</span><span class="o">&amp;</span> <span class="n">Q</span><span class="p">);</span>
    
    <span class="o">/**</span>
     <span class="o">*</span> <span class="nd">@brief</span> <span class="n">Wrap</span> <span class="n">angles</span> <span class="n">to</span> <span class="p">[</span><span class="o">-</span><span class="n">pi</span><span class="p">,</span> <span class="n">pi</span><span class="p">]</span>
     <span class="o">*</span> <span class="nd">@param</span> <span class="n">angle</span> <span class="n">Input</span> <span class="n">angle</span>
     <span class="o">*</span> <span class="nd">@return</span> <span class="n">Wrapped</span> <span class="n">angle</span>
     <span class="o">*/</span>
    <span class="n">double</span> <span class="nf">wrapAngle</span><span class="p">(</span><span class="n">double</span> <span class="n">angle</span><span class="p">);</span>
    
    <span class="o">/**</span>
     <span class="o">*</span> <span class="nd">@brief</span> <span class="n">Calculate</span> <span class="n">state</span> <span class="n">transition</span> <span class="n">Jacobian</span>
     <span class="o">*</span> <span class="nd">@param</span> <span class="n">state</span> <span class="n">Current</span> <span class="n">state</span>
     <span class="o">*</span> <span class="nd">@param</span> <span class="n">dt</span> <span class="n">Time</span> <span class="n">step</span>
     <span class="o">*</span> <span class="nd">@return</span> <span class="n">Jacobian</span> <span class="n">matrix</span>
     <span class="o">*/</span>
    <span class="n">Eigen</span><span class="p">::</span><span class="n">MatrixXd</span> <span class="nf">calculateStateJacobian</span><span class="p">(</span><span class="n">const</span> <span class="n">Eigen</span><span class="p">::</span><span class="n">VectorXd</span><span class="o">&amp;</span> <span class="n">state</span><span class="p">,</span> <span class="n">double</span> <span class="n">dt</span><span class="p">);</span>
    
    <span class="o">//</span> <span class="n">State</span> <span class="n">vector</span><span class="p">:</span> <span class="p">[</span><span class="n">pos_x</span><span class="p">,</span> <span class="n">pos_y</span><span class="p">,</span> <span class="n">pos_z</span><span class="p">,</span> <span class="n">vel_x</span><span class="p">,</span> <span class="n">vel_y</span><span class="p">,</span> <span class="n">vel_z</span><span class="p">,</span>
    <span class="o">//</span>                <span class="n">acc_x</span><span class="p">,</span> <span class="n">acc_y</span><span class="p">,</span> <span class="n">acc_z</span><span class="p">,</span> <span class="n">roll</span><span class="p">,</span> <span class="n">pitch</span><span class="p">,</span> <span class="n">yaw</span><span class="p">,</span>
    <span class="o">//</span>                <span class="n">ang_vel_x</span><span class="p">,</span> <span class="n">ang_vel_y</span><span class="p">,</span> <span class="n">ang_vel_z</span><span class="p">]</span>
    <span class="n">Eigen</span><span class="p">::</span><span class="n">VectorXd</span> <span class="n">state_</span><span class="p">;</span>           <span class="o">//</span> <span class="mi">15</span><span class="n">x1</span> <span class="n">state</span> <span class="n">vector</span>
    <span class="n">Eigen</span><span class="p">::</span><span class="n">MatrixXd</span> <span class="n">covariance_</span><span class="p">;</span>      <span class="o">//</span> <span class="mi">15</span><span class="n">x15</span> <span class="n">covariance</span> <span class="n">matrix</span>
    <span class="n">Eigen</span><span class="p">::</span><span class="n">MatrixXd</span> <span class="n">process_cov_</span><span class="p">;</span>     <span class="o">//</span> <span class="mi">15</span><span class="n">x15</span> <span class="n">process</span> <span class="n">noise</span> <span class="n">covariance</span>
    <span class="n">Eigen</span><span class="p">::</span><span class="n">Vector3d</span> <span class="n">dvl_offset_</span><span class="p">;</span>      <span class="o">//</span> <span class="n">DVL</span> <span class="n">offset</span> <span class="k">from</span> <span class="n">vehicle</span> <span class="n">center</span>
    
    <span class="nb">bool</span> <span class="n">is_initialized_</span><span class="p">;</span>
    <span class="n">double</span> <span class="n">last_update_time_</span><span class="p">;</span>
<span class="p">};</span>

<span class="p">}</span> <span class="o">//</span> <span class="n">namespace</span> <span class="n">modcube_common</span>
</code></pre></div></div> <h3 id="state-estimator-api"> <a href="#state-estimator-api" class="anchor-heading" aria-labelledby="state-estimator-api"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> State Estimator API </h3> <h4 id="modcube_commonstateestimator"> <a href="#modcube_commonstateestimator" class="anchor-heading" aria-labelledby="modcube_commonstateestimator"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <code class="language-plaintext highlighter-rouge">modcube_common::StateEstimator</code> </h4> <div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include</span> <span class="cpf">&lt;modcube_common/state_estimator.h&gt;</span><span class="cp">
</span>
<span class="k">namespace</span> <span class="n">modcube_common</span> <span class="p">{</span>

<span class="k">class</span> <span class="nc">StateEstimator</span> <span class="p">{</span>
<span class="nl">public:</span>
    <span class="cm">/**
     * @brief Constructor
     * @param nh ROS node handle
     */</span>
    <span class="k">explicit</span> <span class="n">StateEstimator</span><span class="p">(</span><span class="n">ros</span><span class="o">::</span><span class="n">NodeHandle</span><span class="o">&amp;</span> <span class="n">nh</span><span class="p">);</span>
    
    <span class="cm">/**
     * @brief Destructor
     */</span>
    <span class="o">~</span><span class="n">StateEstimator</span><span class="p">();</span>
    
    <span class="cm">/**
     * @brief Initialize state estimator
     * @return Success status
     */</span>
    <span class="kt">bool</span> <span class="n">initialize</span><span class="p">();</span>
    
    <span class="cm">/**
     * @brief Start state estimation
     */</span>
    <span class="kt">void</span> <span class="n">start</span><span class="p">();</span>
    
    <span class="cm">/**
     * @brief Stop state estimation
     */</span>
    <span class="kt">void</span> <span class="n">stop</span><span class="p">();</span>
    
    <span class="cm">/**
     * @brief Get current navigation state
     * @return Current navigation state
     */</span>
    <span class="n">modcube_msgs</span><span class="o">::</span><span class="n">NavigationState</span> <span class="n">getCurrentState</span><span class="p">()</span> <span class="k">const</span><span class="p">;</span>
    
<span class="nl">private:</span>
    <span class="cm">/**
     * @brief IMU callback
     * @param msg IMU message
     */</span>
    <span class="kt">void</span> <span class="n">imuCallback</span><span class="p">(</span><span class="k">const</span> <span class="n">sensor_msgs</span><span class="o">::</span><span class="n">Imu</span><span class="o">::</span><span class="n">ConstPtr</span><span class="o">&amp;</span> <span class="n">msg</span><span class="p">);</span>
    
    <span class="cm">/**
     * @brief DVL callback
     * @param msg DVL message
     */</span>
    <span class="kt">void</span> <span class="n">dvlCallback</span><span class="p">(</span><span class="k">const</span> <span class="n">modcube_msgs</span><span class="o">::</span><span class="n">DVLData</span><span class="o">::</span><span class="n">ConstPtr</span><span class="o">&amp;</span> <span class="n">msg</span><span class="p">);</span>
    
    <span class="cm">/**
     * @brief Depth callback
     * @param msg Depth message
     */</span>
    <span class="kt">void</span> <span class="n">depthCallback</span><span class="p">(</span><span class="k">const</span> <span class="n">modcube_msgs</span><span class="o">::</span><span class="n">FluidDepth</span><span class="o">::</span><span class="n">ConstPtr</span><span class="o">&amp;</span> <span class="n">msg</span><span class="p">);</span>
    
    <span class="cm">/**
     * @brief Publish navigation state
     */</span>
    <span class="kt">void</span> <span class="n">publishState</span><span class="p">();</span>
    
    <span class="cm">/**
     * @brief Load configuration parameters
     * @return Success status
     */</span>
    <span class="kt">bool</span> <span class="n">loadConfig</span><span class="p">();</span>
    
    <span class="n">ros</span><span class="o">::</span><span class="n">NodeHandle</span> <span class="n">nh_</span><span class="p">;</span>
    
    <span class="c1">// Subscribers</span>
    <span class="n">ros</span><span class="o">::</span><span class="n">Subscriber</span> <span class="n">imu_sub_</span><span class="p">;</span>
    <span class="n">ros</span><span class="o">::</span><span class="n">Subscriber</span> <span class="n">dvl_sub_</span><span class="p">;</span>
    <span class="n">ros</span><span class="o">::</span><span class="n">Subscriber</span> <span class="n">depth_sub_</span><span class="p">;</span>
    
    <span class="c1">// Publishers</span>
    <span class="n">ros</span><span class="o">::</span><span class="n">Publisher</span> <span class="n">nav_state_pub_</span><span class="p">;</span>
    <span class="n">ros</span><span class="o">::</span><span class="n">Publisher</span> <span class="n">debug_pub_</span><span class="p">;</span>
    
    <span class="c1">// Services</span>
    <span class="n">ros</span><span class="o">::</span><span class="n">ServiceServer</span> <span class="n">reset_service_</span><span class="p">;</span>
    <span class="n">ros</span><span class="o">::</span><span class="n">ServiceServer</span> <span class="n">config_service_</span><span class="p">;</span>
    
    <span class="c1">// EKF instance</span>
    <span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">Ekf</span><span class="o">&gt;</span> <span class="n">ekf_</span><span class="p">;</span>
    
    <span class="c1">// Configuration</span>
    <span class="kt">double</span> <span class="n">publish_rate_</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">base_frame_</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">world_frame_</span><span class="p">;</span>
    
    <span class="c1">// Sensor delays and covariances</span>
    <span class="kt">double</span> <span class="n">imu_delay_</span><span class="p">;</span>
    <span class="kt">double</span> <span class="n">dvl_delay_</span><span class="p">;</span>
    <span class="kt">double</span> <span class="n">depth_delay_</span><span class="p">;</span>
    
    <span class="n">Eigen</span><span class="o">::</span><span class="n">MatrixXd</span> <span class="n">imu_cov_</span><span class="p">;</span>
    <span class="n">Eigen</span><span class="o">::</span><span class="n">MatrixXd</span> <span class="n">dvl_cov_</span><span class="p">;</span>
    <span class="n">Eigen</span><span class="o">::</span><span class="n">MatrixXd</span> <span class="n">depth_cov_</span><span class="p">;</span>
    
    <span class="c1">// State</span>
    <span class="kt">bool</span> <span class="n">is_initialized_</span><span class="p">;</span>
    <span class="kt">bool</span> <span class="n">is_running_</span><span class="p">;</span>
    
    <span class="k">mutable</span> <span class="n">std</span><span class="o">::</span><span class="n">mutex</span> <span class="n">state_mutex_</span><span class="p">;</span>
<span class="p">};</span>

<span class="p">}</span> <span class="c1">// namespace modcube_common</span>
</code></pre></div></div> <h2 id="state-estimation-apis"> <a href="#state-estimation-apis" class="anchor-heading" aria-labelledby="state-estimation-apis"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> State Estimation APIs </h2> <h3 id="multi-sensor-fusion"> <a href="#multi-sensor-fusion" class="anchor-heading" aria-labelledby="multi-sensor-fusion"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Multi-Sensor Fusion </h3> <h4 id="modcube_commonstate_estimationextendedkalmanfilter"> <a href="#modcube_commonstate_estimationextendedkalmanfilter" class="anchor-heading" aria-labelledby="modcube_commonstate_estimationextendedkalmanfilter"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <code class="language-plaintext highlighter-rouge">modcube_common.state_estimation.ExtendedKalmanFilter</code> </h4> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">ExtendedKalmanFilter</span><span class="p">:</span>
    <span class="sh">"""</span><span class="s">Extended Kalman Filter for underwater vehicle state estimation.</span><span class="sh">"""</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">initial_state</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">initial_covariance</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Initialize EKF with optional initial conditions.
        
        Args:
            initial_state (np.ndarray): Initial 15-element state vector
            initial_covariance (np.ndarray): Initial 15x15 covariance matrix
        </span><span class="sh">"""</span>
    
    <span class="k">def</span> <span class="nf">predict</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="n">control_input</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Prediction step of EKF.
        
        Args:
            dt (float): Time step in seconds
            control_input (np.ndarray): Optional control input vector
        </span><span class="sh">"""</span>
    
    <span class="k">def</span> <span class="nf">update_imu</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">acceleration</span><span class="p">,</span> <span class="n">angular_velocity</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Update with IMU measurement.
        
        Args:
            acceleration (np.ndarray): Linear acceleration [ax, ay, az]
            angular_velocity (np.ndarray): Angular velocity [wx, wy, wz]
            orientation (np.ndarray): Optional orientation quaternion [x, y, z, w]
        </span><span class="sh">"""</span>
    
    <span class="k">def</span> <span class="nf">update_dvl</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">velocity</span><span class="p">,</span> <span class="n">altitude</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Update with DVL measurement.
        
        Args:
            velocity (np.ndarray): Velocity measurement [vx, vy, vz]
            altitude (float): Optional altitude measurement
        </span><span class="sh">"""</span>
    
    <span class="k">def</span> <span class="nf">update_depth</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">depth</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Update with depth measurement.
        
        Args:
            depth (float): Depth measurement in meters
        </span><span class="sh">"""</span>
    
    <span class="k">def</span> <span class="nf">update_position</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">position</span><span class="p">,</span> <span class="n">covariance</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Update with absolute position measurement.
        
        Args:
            position (np.ndarray): Position measurement [x, y, z]
            covariance (np.ndarray): Optional measurement covariance
        </span><span class="sh">"""</span>
    
    <span class="k">def</span> <span class="nf">get_state</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Get current state estimate.
        
        Returns:
            dict: State dictionary with position, velocity, acceleration, orientation
        </span><span class="sh">"""</span>
    
    <span class="k">def</span> <span class="nf">get_covariance</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Get current state covariance.
        
        Returns:
            np.ndarray: 15x15 covariance matrix
        </span><span class="sh">"""</span>
    
    <span class="k">def</span> <span class="nf">reset</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">state</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">covariance</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Reset filter state.
        
        Args:
            state (np.ndarray): Optional new state vector
            covariance (np.ndarray): Optional new covariance matrix
        </span><span class="sh">"""</span>
</code></pre></div></div> <h4 id="modcube_commonstate_estimationvisualodometry"> <a href="#modcube_commonstate_estimationvisualodometry" class="anchor-heading" aria-labelledby="modcube_commonstate_estimationvisualodometry"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <code class="language-plaintext highlighter-rouge">modcube_common.state_estimation.VisualOdometry</code> </h4> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">VisualOdometry</span><span class="p">:</span>
    <span class="sh">"""</span><span class="s">Visual odometry for underwater environments.</span><span class="sh">"""</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">camera_params</span><span class="p">,</span> <span class="n">feature_detector</span><span class="o">=</span><span class="sh">'</span><span class="s">ORB</span><span class="sh">'</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Initialize visual odometry.
        
        Args:
            camera_params (dict): Camera calibration parameters
            feature_detector (str): Feature detector type (</span><span class="sh">'</span><span class="s">ORB</span><span class="sh">'</span><span class="s">, </span><span class="sh">'</span><span class="s">SIFT</span><span class="sh">'</span><span class="s">, </span><span class="sh">'</span><span class="s">SURF</span><span class="sh">'</span><span class="s">)
        </span><span class="sh">"""</span>
    
    <span class="k">def</span> <span class="nf">process_frame</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">timestamp</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Process new camera frame.
        
        Args:
            image (np.ndarray): Input image
            timestamp (float): Image timestamp
        
        Returns:
            dict: Pose estimate and confidence
        </span><span class="sh">"""</span>
    
    <span class="k">def</span> <span class="nf">get_pose_estimate</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Get current pose estimate.
        
        Returns:
            geometry_msgs/PoseWithCovariance: Current pose estimate
        </span><span class="sh">"""</span>
    
    <span class="k">def</span> <span class="nf">reset_tracking</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Reset visual tracking.</span><span class="sh">"""</span>
</code></pre></div></div> <h2 id="trajectory-generation-apis"> <a href="#trajectory-generation-apis" class="anchor-heading" aria-labelledby="trajectory-generation-apis"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Trajectory Generation APIs </h2> <h3 id="optimal-trajectory-planning"> <a href="#optimal-trajectory-planning" class="anchor-heading" aria-labelledby="optimal-trajectory-planning"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Optimal Trajectory Planning </h3> <h4 id="modcube_commontrajectorydronetrajectory"> <a href="#modcube_commontrajectorydronetrajectory" class="anchor-heading" aria-labelledby="modcube_commontrajectorydronetrajectory"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <code class="language-plaintext highlighter-rouge">modcube_common.trajectory.DroneTrajectory</code> </h4> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">DroneTrajectory</span><span class="p">:</span>
    <span class="sh">"""</span><span class="s">Optimal spline trajectory generator for underwater vehicles.</span><span class="sh">"""</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Initialize trajectory generator.</span><span class="sh">"""</span>
    
    <span class="k">def</span> <span class="nf">solve</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">waypoints</span><span class="p">,</span> <span class="n">aggressiveness</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">start_vel</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">end_vel</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Generate optimal trajectory through waypoints.
        
        Args:
            waypoints (list): List of TrajectoryWaypoint objects
            aggressiveness (float): Trajectory aggressiveness [0.0, 1.0]
            start_vel (np.ndarray): Initial velocity [vx, vy, vz]
            end_vel (np.ndarray): Final velocity [vx, vy, vz]
        
        Returns:
            bool: Success status
        </span><span class="sh">"""</span>
    
    <span class="k">def</span> <span class="nf">evaluate</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Evaluate trajectory at given time.
        
        Args:
            t (float): Time from trajectory start
        
        Returns:
            dict: Position, velocity, acceleration at time t
        </span><span class="sh">"""</span>
    
    <span class="k">def</span> <span class="nf">get_position</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Get position at time t.
        
        Args:
            t (float): Time from trajectory start
        
        Returns:
            np.ndarray: Position [x, y, z]
        </span><span class="sh">"""</span>
    
    <span class="k">def</span> <span class="nf">get_velocity</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Get velocity at time t.
        
        Args:
            t (float): Time from trajectory start
        
        Returns:
            np.ndarray: Velocity [vx, vy, vz]
        </span><span class="sh">"""</span>
    
    <span class="k">def</span> <span class="nf">get_acceleration</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Get acceleration at time t.
        
        Args:
            t (float): Time from trajectory start
        
        Returns:
            np.ndarray: Acceleration [ax, ay, az]
        </span><span class="sh">"""</span>
    
    <span class="k">def</span> <span class="nf">to_path_msg</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="mf">0.1</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Convert trajectory to ROS Path message.
        
        Args:
            dt (float): Time step for path discretization
        
        Returns:
            nav_msgs/Path: ROS path message
        </span><span class="sh">"""</span>
    
    <span class="k">def</span> <span class="nf">get_total_time</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Get total trajectory time.
        
        Returns:
            float: Total time in seconds
        </span><span class="sh">"""</span>
    
    <span class="k">def</span> <span class="nf">get_total_distance</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Get total trajectory distance.
        
        Returns:
            float: Total distance in meters
        </span><span class="sh">"""</span>
    
    <span class="k">def</span> <span class="nf">get_average_speed</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Get average trajectory speed.
        
        Returns:
            float: Average speed in m/s
        </span><span class="sh">"""</span>
</code></pre></div></div> <h4 id="modcube_commontrajectorytrajectorywaypoint"> <a href="#modcube_commontrajectorytrajectorywaypoint" class="anchor-heading" aria-labelledby="modcube_commontrajectorytrajectorywaypoint"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <code class="language-plaintext highlighter-rouge">modcube_common.trajectory.TrajectoryWaypoint</code> </h4> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">TrajectoryWaypoint</span><span class="p">:</span>
    <span class="sh">"""</span><span class="s">Waypoint for trajectory generation.</span><span class="sh">"""</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">position</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">constraints</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Initialize waypoint.
        
        Args:
            position (np.ndarray): Waypoint position [x, y, z]
            orientation (np.ndarray): Optional orientation quaternion [x, y, z, w]
            constraints (dict): Optional velocity/acceleration constraints
        </span><span class="sh">"""</span>
    
    <span class="k">def</span> <span class="nf">set_velocity_constraint</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">velocity</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Set velocity constraint at waypoint.
        
        Args:
            velocity (np.ndarray): Velocity constraint [vx, vy, vz]
        </span><span class="sh">"""</span>
    
    <span class="k">def</span> <span class="nf">set_acceleration_constraint</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">acceleration</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Set acceleration constraint at waypoint.
        
        Args:
            acceleration (np.ndarray): Acceleration constraint [ax, ay, az]
        </span><span class="sh">"""</span>
</code></pre></div></div> <h3 id="minimum-snap-trajectory"> <a href="#minimum-snap-trajectory" class="anchor-heading" aria-labelledby="minimum-snap-trajectory"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Minimum Snap Trajectory </h3> <h4 id="modcube_commontrajectoryoptimaltrajectory"> <a href="#modcube_commontrajectoryoptimaltrajectory" class="anchor-heading" aria-labelledby="modcube_commontrajectoryoptimaltrajectory"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <code class="language-plaintext highlighter-rouge">modcube_common.trajectory.OptimalTrajectory</code> </h4> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">OptimalTrajectory</span><span class="p">:</span>
    <span class="sh">"""</span><span class="s">Minimum snap trajectory optimization.</span><span class="sh">"""</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">dimension</span><span class="o">=</span><span class="mi">3</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Initialize trajectory optimizer.
        
        Args:
            dimension (int): Spatial dimension (3 for 3D trajectories)
        </span><span class="sh">"""</span>
    
    <span class="k">def</span> <span class="nf">generate_trajectory</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">waypoints</span><span class="p">,</span> <span class="n">time_allocation</span><span class="p">,</span> 
                          <span class="n">derivative_order</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">continuity_order</span><span class="o">=</span><span class="mi">3</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Generate minimum snap trajectory.
        
        Args:
            waypoints (list): List of waypoint positions
            time_allocation (list): Time allocation between waypoints
            derivative_order (int): Order of derivative to minimize (4 for snap)
            continuity_order (int): Continuity order at waypoints
        
        Returns:
            dict: Trajectory coefficients and metadata
        </span><span class="sh">"""</span>
    
    <span class="k">def</span> <span class="nf">evaluate_polynomial</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">coefficients</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">derivative</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Evaluate polynomial trajectory.
        
        Args:
            coefficients (np.ndarray): Polynomial coefficients
            t (float): Time parameter
            derivative (int): Derivative order (0=position, 1=velocity, etc.)
        
        Returns:
            np.ndarray: Evaluated trajectory point
        </span><span class="sh">"""</span>
</code></pre></div></div> <h3 id="path-planning-and-navigation"> <a href="#path-planning-and-navigation" class="anchor-heading" aria-labelledby="path-planning-and-navigation"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Path Planning and Navigation </h3> <h4 id="modcube_commonnavigationpathplanner"> <a href="#modcube_commonnavigationpathplanner" class="anchor-heading" aria-labelledby="modcube_commonnavigationpathplanner"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <code class="language-plaintext highlighter-rouge">modcube_common.navigation.PathPlanner</code> </h4> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">PathPlanner</span><span class="p">:</span>
    <span class="sh">"""</span><span class="s">A* and RRT* path planning for underwater environments.</span><span class="sh">"""</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">occupancy_map</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">planning_algorithm</span><span class="o">=</span><span class="sh">'</span><span class="s">A*</span><span class="sh">'</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Initialize path planner.
        
        Args:
            occupancy_map (OccupancyGrid): Optional occupancy grid map
            planning_algorithm (str): Planning algorithm (</span><span class="sh">'</span><span class="s">A*</span><span class="sh">'</span><span class="s">, </span><span class="sh">'</span><span class="s">RRT*</span><span class="sh">'</span><span class="s">, </span><span class="sh">'</span><span class="s">PRM</span><span class="sh">'</span><span class="s">)
        </span><span class="sh">"""</span>
    
    <span class="k">def</span> <span class="nf">plan_path</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">goal</span><span class="p">,</span> <span class="n">constraints</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Plan path from start to goal.
        
        Args:
            start (np.ndarray): Start position [x, y, z]
            goal (np.ndarray): Goal position [x, y, z]
            constraints (dict): Optional planning constraints
        
        Returns:
            list: List of waypoints forming the path
        </span><span class="sh">"""</span>
    
    <span class="k">def</span> <span class="nf">update_map</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">occupancy_grid</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Update occupancy map.
        
        Args:
            occupancy_grid (nav_msgs/OccupancyGrid): New occupancy grid
        </span><span class="sh">"""</span>
    
    <span class="k">def</span> <span class="nf">set_vehicle_constraints</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">max_velocity</span><span class="p">,</span> <span class="n">max_acceleration</span><span class="p">,</span> <span class="n">turning_radius</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Set vehicle dynamic constraints.
        
        Args:
            max_velocity (float): Maximum velocity in m/s
            max_acceleration (float): Maximum acceleration in m/s
            turning_radius (float): Minimum turning radius in meters
        </span><span class="sh">"""</span>
</code></pre></div></div> <h4 id="modcube_commonnavigationobstacleavoidance"> <a href="#modcube_commonnavigationobstacleavoidance" class="anchor-heading" aria-labelledby="modcube_commonnavigationobstacleavoidance"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <code class="language-plaintext highlighter-rouge">modcube_common.navigation.ObstacleAvoidance</code> </h4> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">ObstacleAvoidance</span><span class="p">:</span>
    <span class="sh">"""</span><span class="s">Real-time obstacle avoidance using potential fields.</span><span class="sh">"""</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">safety_distance</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">max_avoidance_force</span><span class="o">=</span><span class="mf">5.0</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Initialize obstacle avoidance.
        
        Args:
            safety_distance (float): Minimum distance to obstacles in meters
            max_avoidance_force (float): Maximum avoidance force magnitude
        </span><span class="sh">"""</span>
    
    <span class="k">def</span> <span class="nf">compute_avoidance_force</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">current_position</span><span class="p">,</span> <span class="n">obstacles</span><span class="p">,</span> <span class="n">target_velocity</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Compute obstacle avoidance force.
        
        Args:
            current_position (np.ndarray): Current vehicle position [x, y, z]
            obstacles (list): List of obstacle positions and sizes
            target_velocity (np.ndarray): Desired velocity [vx, vy, vz]
        
        Returns:
            np.ndarray: Avoidance force vector [fx, fy, fz]
        </span><span class="sh">"""</span>
    
    <span class="k">def</span> <span class="nf">update_obstacles</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">sensor_data</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Update obstacle map from sensor data.
        
        Args:
            sensor_data (dict): Sensor data including sonar, lidar, camera
        </span><span class="sh">"""</span>
</code></pre></div></div> <h2 id="advanced-configuration-parameters"> <a href="#advanced-configuration-parameters" class="anchor-heading" aria-labelledby="advanced-configuration-parameters"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Advanced Configuration Parameters </h2> <h3 id="controller-parameters"> <a href="#controller-parameters" class="anchor-heading" aria-labelledby="controller-parameters"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Controller Parameters </h3> <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># PID Controller</span>
<span class="na">controller</span><span class="pi">:</span>
  <span class="na">position_gains</span><span class="pi">:</span>
    <span class="na">p</span><span class="pi">:</span> <span class="pi">[</span><span class="nv">10.0</span><span class="pi">,</span> <span class="nv">10.0</span><span class="pi">,</span> <span class="nv">10.0</span><span class="pi">]</span>  <span class="c1"># Proportional gains [x, y, z]</span>
    <span class="na">i</span><span class="pi">:</span> <span class="pi">[</span><span class="nv">0.1</span><span class="pi">,</span> <span class="nv">0.1</span><span class="pi">,</span> <span class="nv">0.1</span><span class="pi">]</span>     <span class="c1"># Integral gains [x, y, z]</span>
    <span class="na">d</span><span class="pi">:</span> <span class="pi">[</span><span class="nv">5.0</span><span class="pi">,</span> <span class="nv">5.0</span><span class="pi">,</span> <span class="nv">5.0</span><span class="pi">]</span>     <span class="c1"># Derivative gains [x, y, z]</span>
  <span class="na">orientation_gains</span><span class="pi">:</span>
    <span class="na">p</span><span class="pi">:</span> <span class="pi">[</span><span class="nv">20.0</span><span class="pi">,</span> <span class="nv">20.0</span><span class="pi">,</span> <span class="nv">20.0</span><span class="pi">]</span>  <span class="c1"># Proportional gains [roll, pitch, yaw]</span>
    <span class="na">i</span><span class="pi">:</span> <span class="pi">[</span><span class="nv">0.2</span><span class="pi">,</span> <span class="nv">0.2</span><span class="pi">,</span> <span class="nv">0.2</span><span class="pi">]</span>     <span class="c1"># Integral gains [roll, pitch, yaw]</span>
    <span class="na">d</span><span class="pi">:</span> <span class="pi">[</span><span class="nv">8.0</span><span class="pi">,</span> <span class="nv">8.0</span><span class="pi">,</span> <span class="nv">8.0</span><span class="pi">]</span>     <span class="c1"># Derivative gains [roll, pitch, yaw]</span>
  <span class="na">max_thrust</span><span class="pi">:</span> <span class="m">100.0</span>        <span class="c1"># Maximum thrust (N)</span>
  <span class="na">control_frequency</span><span class="pi">:</span> <span class="m">100</span>   <span class="c1"># Control loop frequency (Hz)</span>
  
  <span class="c1"># Advanced controller settings</span>
  <span class="na">adaptive_gains</span><span class="pi">:</span>
    <span class="na">enabled</span><span class="pi">:</span> <span class="kc">true</span>
    <span class="na">adaptation_rate</span><span class="pi">:</span> <span class="m">0.01</span>
    <span class="na">min_gain_factor</span><span class="pi">:</span> <span class="m">0.1</span>
    <span class="na">max_gain_factor</span><span class="pi">:</span> <span class="m">5.0</span>
  
  <span class="na">anti_windup</span><span class="pi">:</span>
    <span class="na">enabled</span><span class="pi">:</span> <span class="kc">true</span>
    <span class="na">max_integral</span><span class="pi">:</span> <span class="pi">[</span><span class="nv">10.0</span><span class="pi">,</span> <span class="nv">10.0</span><span class="pi">,</span> <span class="nv">10.0</span><span class="pi">,</span> <span class="nv">5.0</span><span class="pi">,</span> <span class="nv">5.0</span><span class="pi">,</span> <span class="nv">5.0</span><span class="pi">]</span>
  
  <span class="na">feedforward</span><span class="pi">:</span>
    <span class="na">enabled</span><span class="pi">:</span> <span class="kc">true</span>
    <span class="na">velocity_ff</span><span class="pi">:</span> <span class="pi">[</span><span class="nv">0.8</span><span class="pi">,</span> <span class="nv">0.8</span><span class="pi">,</span> <span class="nv">0.8</span><span class="pi">]</span>
    <span class="na">acceleration_ff</span><span class="pi">:</span> <span class="pi">[</span><span class="nv">0.2</span><span class="pi">,</span> <span class="nv">0.2</span><span class="pi">,</span> <span class="nv">0.2</span><span class="pi">]</span>
  
  <span class="na">saturation_limits</span><span class="pi">:</span>
    <span class="na">position_error_max</span><span class="pi">:</span> <span class="pi">[</span><span class="nv">5.0</span><span class="pi">,</span> <span class="nv">5.0</span><span class="pi">,</span> <span class="nv">5.0</span><span class="pi">]</span>  <span class="c1"># Maximum position error (m)</span>
    <span class="na">velocity_max</span><span class="pi">:</span> <span class="pi">[</span><span class="nv">2.0</span><span class="pi">,</span> <span class="nv">2.0</span><span class="pi">,</span> <span class="nv">2.0</span><span class="pi">]</span>        <span class="c1"># Maximum velocity (m/s)</span>
    <span class="na">angular_velocity_max</span><span class="pi">:</span> <span class="pi">[</span><span class="nv">1.0</span><span class="pi">,</span> <span class="nv">1.0</span><span class="pi">,</span> <span class="nv">1.0</span><span class="pi">]</span> <span class="c1"># Maximum angular velocity (rad/s)</span>
</code></pre></div></div> <h3 id="thruster-manager-parameters"> <a href="#thruster-manager-parameters" class="anchor-heading" aria-labelledby="thruster-manager-parameters"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Thruster Manager Parameters </h3> <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Thruster Manager</span>
<span class="na">thruster_manager</span><span class="pi">:</span>
  <span class="na">thrusters</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">id</span><span class="pi">:</span> <span class="m">0</span>
      <span class="na">frame</span><span class="pi">:</span> <span class="s2">"</span><span class="s">thruster_0"</span>
      <span class="na">max_thrust</span><span class="pi">:</span> <span class="m">50.0</span>
      <span class="na">topic</span><span class="pi">:</span> <span class="s2">"</span><span class="s">/modcube/thrusters/0/input"</span>
    <span class="pi">-</span> <span class="na">id</span><span class="pi">:</span> <span class="m">1</span>
      <span class="na">frame</span><span class="pi">:</span> <span class="s2">"</span><span class="s">thruster_1"</span>
      <span class="na">max_thrust</span><span class="pi">:</span> <span class="m">50.0</span>
      <span class="na">topic</span><span class="pi">:</span> <span class="s2">"</span><span class="s">/modcube/thrusters/1/input"</span>
    <span class="c1"># ... additional thrusters</span>
  
  <span class="na">allocation_matrix</span><span class="pi">:</span> <span class="s2">"</span><span class="s">tam_14_thrusters.yaml"</span>
  <span class="na">update_rate</span><span class="pi">:</span> <span class="m">50</span>  <span class="c1"># Hz</span>
</code></pre></div></div> <h3 id="sensor-parameters"> <a href="#sensor-parameters" class="anchor-heading" aria-labelledby="sensor-parameters"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Sensor Parameters </h3> <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># IMU Configuration</span>
<span class="na">imu</span><span class="pi">:</span>
  <span class="na">frame_id</span><span class="pi">:</span> <span class="s2">"</span><span class="s">imu_link"</span>
  <span class="na">topic</span><span class="pi">:</span> <span class="s2">"</span><span class="s">/modcube/imu/data"</span>
  <span class="na">frequency</span><span class="pi">:</span> <span class="m">100</span>
  <span class="na">orientation_covariance</span><span class="pi">:</span> <span class="pi">[</span><span class="nv">0.01</span><span class="pi">,</span> <span class="nv">0.01</span><span class="pi">,</span> <span class="nv">0.01</span><span class="pi">]</span>
  <span class="na">angular_velocity_covariance</span><span class="pi">:</span> <span class="pi">[</span><span class="nv">0.001</span><span class="pi">,</span> <span class="nv">0.001</span><span class="pi">,</span> <span class="nv">0.001</span><span class="pi">]</span>
  <span class="na">linear_acceleration_covariance</span><span class="pi">:</span> <span class="pi">[</span><span class="nv">0.01</span><span class="pi">,</span> <span class="nv">0.01</span><span class="pi">,</span> <span class="nv">0.01</span><span class="pi">]</span>
  <span class="na">bias_estimation</span><span class="pi">:</span>
    <span class="na">enabled</span><span class="pi">:</span> <span class="kc">true</span>
    <span class="na">gyro_bias_std</span><span class="pi">:</span> <span class="m">0.001</span>
    <span class="na">accel_bias_std</span><span class="pi">:</span> <span class="m">0.01</span>
  <span class="na">calibration</span><span class="pi">:</span>
    <span class="na">auto_calibrate</span><span class="pi">:</span> <span class="kc">true</span>
    <span class="na">calibration_time</span><span class="pi">:</span> <span class="m">30.0</span>  <span class="c1"># seconds</span>

<span class="c1"># DVL Configuration</span>
<span class="na">dvl</span><span class="pi">:</span>
  <span class="na">frame_id</span><span class="pi">:</span> <span class="s2">"</span><span class="s">dvl_link"</span>
  <span class="na">topic</span><span class="pi">:</span> <span class="s2">"</span><span class="s">/modcube/dvl/data"</span>
  <span class="na">frequency</span><span class="pi">:</span> <span class="m">10</span>
  <span class="na">velocity_covariance</span><span class="pi">:</span> <span class="pi">[</span><span class="nv">0.01</span><span class="pi">,</span> <span class="nv">0.01</span><span class="pi">,</span> <span class="nv">0.01</span><span class="pi">]</span>
  <span class="na">altitude_covariance</span><span class="pi">:</span> <span class="m">0.1</span>
  <span class="na">beam_configuration</span><span class="pi">:</span>
    <span class="na">num_beams</span><span class="pi">:</span> <span class="m">4</span>
    <span class="na">beam_angle</span><span class="pi">:</span> <span class="m">30.0</span>  <span class="c1"># degrees</span>
    <span class="na">max_range</span><span class="pi">:</span> <span class="m">100.0</span>  <span class="c1"># meters</span>
  <span class="na">outlier_rejection</span><span class="pi">:</span>
    <span class="na">enabled</span><span class="pi">:</span> <span class="kc">true</span>
    <span class="na">velocity_threshold</span><span class="pi">:</span> <span class="m">5.0</span>  <span class="c1"># m/s</span>
    <span class="na">altitude_threshold</span><span class="pi">:</span> <span class="m">200.0</span>  <span class="c1"># m</span>

<span class="c1"># Depth Sensor Configuration</span>
<span class="na">depth_sensor</span><span class="pi">:</span>
  <span class="na">frame_id</span><span class="pi">:</span> <span class="s2">"</span><span class="s">depth_link"</span>
  <span class="na">topic</span><span class="pi">:</span> <span class="s2">"</span><span class="s">/modcube/depth"</span>
  <span class="na">frequency</span><span class="pi">:</span> <span class="m">20</span>
  <span class="na">depth_covariance</span><span class="pi">:</span> <span class="m">0.01</span>
  <span class="na">pressure_to_depth</span><span class="pi">:</span>
    <span class="na">water_density</span><span class="pi">:</span> <span class="m">1025.0</span>  <span class="c1"># kg/m</span>
    <span class="na">gravity</span><span class="pi">:</span> <span class="m">9.81</span>  <span class="c1"># m/s</span>
    <span class="na">atmospheric_pressure</span><span class="pi">:</span> <span class="m">101325.0</span>  <span class="c1"># Pa</span>
  <span class="na">filtering</span><span class="pi">:</span>
    <span class="na">enabled</span><span class="pi">:</span> <span class="kc">true</span>
    <span class="na">filter_type</span><span class="pi">:</span> <span class="s2">"</span><span class="s">low_pass"</span>
    <span class="na">cutoff_frequency</span><span class="pi">:</span> <span class="m">5.0</span>  <span class="c1"># Hz</span>

<span class="c1"># Camera Configuration</span>
<span class="na">camera</span><span class="pi">:</span>
  <span class="na">frame_id</span><span class="pi">:</span> <span class="s2">"</span><span class="s">camera_link"</span>
  <span class="na">image_topic</span><span class="pi">:</span> <span class="s2">"</span><span class="s">/modcube/camera/image_raw"</span>
  <span class="na">info_topic</span><span class="pi">:</span> <span class="s2">"</span><span class="s">/modcube/camera/camera_info"</span>
  <span class="na">frequency</span><span class="pi">:</span> <span class="m">30</span>
  <span class="na">resolution</span><span class="pi">:</span> <span class="pi">[</span><span class="nv">1920</span><span class="pi">,</span> <span class="nv">1080</span><span class="pi">]</span>
  <span class="na">field_of_view</span><span class="pi">:</span> <span class="pi">[</span><span class="nv">90.0</span><span class="pi">,</span> <span class="nv">60.0</span><span class="pi">]</span>  <span class="c1"># [horizontal, vertical] degrees</span>
  <span class="na">exposure</span><span class="pi">:</span>
    <span class="na">auto_exposure</span><span class="pi">:</span> <span class="kc">true</span>
    <span class="na">exposure_time</span><span class="pi">:</span> <span class="m">0.033</span>  <span class="c1"># seconds</span>
  <span class="na">white_balance</span><span class="pi">:</span>
    <span class="na">auto_white_balance</span><span class="pi">:</span> <span class="kc">true</span>
    <span class="na">color_temperature</span><span class="pi">:</span> <span class="m">5000</span>  <span class="c1"># K</span>

<span class="c1"># Sonar Configuration</span>
<span class="na">sonar</span><span class="pi">:</span>
  <span class="na">frame_id</span><span class="pi">:</span> <span class="s2">"</span><span class="s">sonar_link"</span>
  <span class="na">topic</span><span class="pi">:</span> <span class="s2">"</span><span class="s">/modcube/sonar/data"</span>
  <span class="na">frequency</span><span class="pi">:</span> <span class="m">10</span>
  <span class="na">range_min</span><span class="pi">:</span> <span class="m">0.5</span>  <span class="c1"># meters</span>
  <span class="na">range_max</span><span class="pi">:</span> <span class="m">50.0</span>  <span class="c1"># meters</span>
  <span class="na">field_of_view</span><span class="pi">:</span> <span class="m">120.0</span>  <span class="c1"># degrees</span>
  <span class="na">resolution</span><span class="pi">:</span> <span class="m">1.0</span>  <span class="c1"># degrees</span>
</code></pre></div></div> <h2 id="plugin-apis"> <a href="#plugin-apis" class="anchor-heading" aria-labelledby="plugin-apis"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Plugin APIs </h2> <h3 id="gazebo-plugin-api"> <a href="#gazebo-plugin-api" class="anchor-heading" aria-labelledby="gazebo-plugin-api"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Gazebo Plugin API </h3> <h4 id="custom-thruster-plugin"> <a href="#custom-thruster-plugin" class="anchor-heading" aria-labelledby="custom-thruster-plugin"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Custom Thruster Plugin </h4> <div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// custom_thruster_plugin.h</span>
<span class="cp">#include</span> <span class="cpf">&lt;gazebo/gazebo.hh&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;gazebo/physics/physics.hh&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;ros/ros.h&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;modcube_msgs/ThrusterCommand.h&gt;</span><span class="cp">
</span>
<span class="k">namespace</span> <span class="n">gazebo</span> <span class="p">{</span>
    <span class="k">class</span> <span class="nc">CustomThrusterPlugin</span> <span class="o">:</span> <span class="k">public</span> <span class="n">ModelPlugin</span> <span class="p">{</span>
    <span class="nl">public:</span>
        <span class="n">CustomThrusterPlugin</span><span class="p">();</span>
        <span class="k">virtual</span> <span class="o">~</span><span class="n">CustomThrusterPlugin</span><span class="p">();</span>
        
        <span class="k">virtual</span> <span class="kt">void</span> <span class="n">Load</span><span class="p">(</span><span class="n">physics</span><span class="o">::</span><span class="n">ModelPtr</span> <span class="n">_model</span><span class="p">,</span> <span class="n">sdf</span><span class="o">::</span><span class="n">ElementPtr</span> <span class="n">_sdf</span><span class="p">);</span>
        <span class="k">virtual</span> <span class="kt">void</span> <span class="n">Update</span><span class="p">();</span>
        
    <span class="nl">private:</span>
        <span class="kt">void</span> <span class="n">ThrusterCallback</span><span class="p">(</span><span class="k">const</span> <span class="n">modcube_msgs</span><span class="o">::</span><span class="n">ThrusterCommand</span><span class="o">::</span><span class="n">ConstPtr</span><span class="o">&amp;</span> <span class="n">msg</span><span class="p">);</span>
        
        <span class="n">physics</span><span class="o">::</span><span class="n">ModelPtr</span> <span class="n">model_</span><span class="p">;</span>
        <span class="n">physics</span><span class="o">::</span><span class="n">LinkPtr</span> <span class="n">link_</span><span class="p">;</span>
        <span class="n">event</span><span class="o">::</span><span class="n">ConnectionPtr</span> <span class="n">update_connection_</span><span class="p">;</span>
        
        <span class="n">ros</span><span class="o">::</span><span class="n">NodeHandle</span> <span class="n">nh_</span><span class="p">;</span>
        <span class="n">ros</span><span class="o">::</span><span class="n">Subscriber</span> <span class="n">thruster_sub_</span><span class="p">;</span>
        
        <span class="kt">double</span> <span class="n">thrust_force_</span><span class="p">;</span>
        <span class="n">math</span><span class="o">::</span><span class="n">Vector3</span> <span class="n">thrust_direction_</span><span class="p">;</span>
    <span class="p">};</span>
<span class="p">}</span>
</code></pre></div></div> <h3 id="ros-plugin-api"> <a href="#ros-plugin-api" class="anchor-heading" aria-labelledby="ros-plugin-api"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> ROS Plugin API </h3> <h4 id="custom-sensor-plugin"> <a href="#custom-sensor-plugin" class="anchor-heading" aria-labelledby="custom-sensor-plugin"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Custom Sensor Plugin </h4> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># custom_sensor_plugin.py
</span><span class="kn">import</span> <span class="n">rospy</span>
<span class="kn">from</span> <span class="n">sensor_msgs.msg</span> <span class="kn">import</span> <span class="n">PointCloud2</span>
<span class="kn">from</span> <span class="n">modcube_msgs.msg</span> <span class="kn">import</span> <span class="n">CustomSensorData</span>

<span class="k">class</span> <span class="nc">CustomSensorPlugin</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">pub</span> <span class="o">=</span> <span class="n">rospy</span><span class="p">.</span><span class="nc">Publisher</span><span class="p">(</span><span class="sh">'</span><span class="s">/modcube/custom_sensor</span><span class="sh">'</span><span class="p">,</span> <span class="n">CustomSensorData</span><span class="p">,</span> <span class="n">queue_size</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">sub</span> <span class="o">=</span> <span class="n">rospy</span><span class="p">.</span><span class="nc">Subscriber</span><span class="p">(</span><span class="sh">'</span><span class="s">/camera/depth/points</span><span class="sh">'</span><span class="p">,</span> <span class="n">PointCloud2</span><span class="p">,</span> <span class="n">self</span><span class="p">.</span><span class="n">pointcloud_callback</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">pointcloud_callback</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">):</span>
        <span class="c1"># Process point cloud data
</span>        <span class="n">processed_data</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">process_pointcloud</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        
        <span class="c1"># Publish custom sensor data
</span>        <span class="n">custom_msg</span> <span class="o">=</span> <span class="nc">CustomSensorData</span><span class="p">()</span>
        <span class="n">custom_msg</span><span class="p">.</span><span class="n">header</span> <span class="o">=</span> <span class="n">msg</span><span class="p">.</span><span class="n">header</span>
        <span class="n">custom_msg</span><span class="p">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">processed_data</span>
        
        <span class="n">self</span><span class="p">.</span><span class="n">pub</span><span class="p">.</span><span class="nf">publish</span><span class="p">(</span><span class="n">custom_msg</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">process_pointcloud</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">pointcloud</span><span class="p">):</span>
        <span class="c1"># Custom processing logic
</span>        <span class="k">return</span> <span class="n">processed_data</span>
</code></pre></div></div> <h2 id="examples"> <a href="#examples" class="anchor-heading" aria-labelledby="examples"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Examples </h2> <h3 id="basic-control-example"> <a href="#basic-control-example" class="anchor-heading" aria-labelledby="basic-control-example"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Basic Control Example </h3> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#!/usr/bin/env python
</span><span class="kn">import</span> <span class="n">rospy</span>
<span class="kn">from</span> <span class="n">modcube_common.motion</span> <span class="kn">import</span> <span class="n">MotionClient</span>
<span class="kn">from</span> <span class="n">geometry_msgs.msg</span> <span class="kn">import</span> <span class="n">Pose</span><span class="p">,</span> <span class="n">Point</span><span class="p">,</span> <span class="n">Quaternion</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">rospy</span><span class="p">.</span><span class="nf">init_node</span><span class="p">(</span><span class="sh">'</span><span class="s">basic_control_example</span><span class="sh">'</span><span class="p">)</span>
    
    <span class="c1"># Initialize motion client
</span>    <span class="n">motion</span> <span class="o">=</span> <span class="nc">MotionClient</span><span class="p">()</span>
    
    <span class="c1"># Wait for system to be ready
</span>    <span class="n">rospy</span><span class="p">.</span><span class="nf">sleep</span><span class="p">(</span><span class="mf">2.0</span><span class="p">)</span>
    
    <span class="c1"># Move to different positions
</span>    <span class="n">positions</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span>
        <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span>
        <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span>
        <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span>
        <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="p">]</span>
    
    <span class="k">for</span> <span class="n">pos</span> <span class="ow">in</span> <span class="n">positions</span><span class="p">:</span>
        <span class="n">rospy</span><span class="p">.</span><span class="nf">loginfo</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Moving to position: </span><span class="si">{</span><span class="n">pos</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
        <span class="n">success</span> <span class="o">=</span> <span class="n">motion</span><span class="p">.</span><span class="nf">goto_position</span><span class="p">(</span><span class="n">pos</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">pos</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">pos</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">timeout</span><span class="o">=</span><span class="mf">30.0</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">success</span><span class="p">:</span>
            <span class="n">rospy</span><span class="p">.</span><span class="nf">loginfo</span><span class="p">(</span><span class="sh">"</span><span class="s">Position reached successfully</span><span class="sh">"</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">rospy</span><span class="p">.</span><span class="nf">logwarn</span><span class="p">(</span><span class="sh">"</span><span class="s">Failed to reach position</span><span class="sh">"</span><span class="p">)</span>
        
        <span class="n">rospy</span><span class="p">.</span><span class="nf">sleep</span><span class="p">(</span><span class="mf">2.0</span><span class="p">)</span>
    
    <span class="n">rospy</span><span class="p">.</span><span class="nf">loginfo</span><span class="p">(</span><span class="sh">"</span><span class="s">Mission completed</span><span class="sh">"</span><span class="p">)</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="sh">'</span><span class="s">__main__</span><span class="sh">'</span><span class="p">:</span>
    <span class="nf">main</span><span class="p">()</span>
</code></pre></div></div> <h3 id="advanced-trajectory-following-example"> <a href="#advanced-trajectory-following-example" class="anchor-heading" aria-labelledby="advanced-trajectory-following-example"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Advanced Trajectory Following Example </h3> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#!/usr/bin/env python
</span><span class="kn">import</span> <span class="n">rospy</span>
<span class="kn">import</span> <span class="n">numpy</span> <span class="k">as</span> <span class="n">np</span>
<span class="kn">from</span> <span class="n">modcube_common.trajectory</span> <span class="kn">import</span> <span class="n">DroneTrajectory</span><span class="p">,</span> <span class="n">TrajectoryWaypoint</span>
<span class="kn">from</span> <span class="n">modcube_common.motion</span> <span class="kn">import</span> <span class="n">MotionClient</span>
<span class="kn">from</span> <span class="n">geometry_msgs.msg</span> <span class="kn">import</span> <span class="n">Point</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">rospy</span><span class="p">.</span><span class="nf">init_node</span><span class="p">(</span><span class="sh">'</span><span class="s">trajectory_following_example</span><span class="sh">'</span><span class="p">)</span>
    
    <span class="c1"># Initialize trajectory generator and motion client
</span>    <span class="n">trajectory</span> <span class="o">=</span> <span class="nc">DroneTrajectory</span><span class="p">()</span>
    <span class="n">motion</span> <span class="o">=</span> <span class="nc">MotionClient</span><span class="p">()</span>
    
    <span class="c1"># Define waypoints for a complex 3D trajectory
</span>    <span class="n">waypoints</span> <span class="o">=</span> <span class="p">[</span>
        <span class="nc">TrajectoryWaypoint</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]),</span>
        <span class="nc">TrajectoryWaypoint</span><span class="p">([</span><span class="mi">10</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]),</span>
        <span class="nc">TrajectoryWaypoint</span><span class="p">([</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="o">-</span><span class="mi">3</span><span class="p">]),</span>
        <span class="nc">TrajectoryWaypoint</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="o">-</span><span class="mi">5</span><span class="p">]),</span>
        <span class="nc">TrajectoryWaypoint</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">3</span><span class="p">]),</span>
        <span class="nc">TrajectoryWaypoint</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">])</span>
    <span class="p">]</span>
    
    <span class="c1"># Set velocity constraints for smooth motion
</span>    <span class="n">waypoints</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nf">set_velocity_constraint</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>  <span class="c1"># Start from rest
</span>    <span class="n">waypoints</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">].</span><span class="nf">set_velocity_constraint</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>  <span class="c1"># End at rest
</span>    
    <span class="c1"># Generate optimal trajectory
</span>    <span class="n">rospy</span><span class="p">.</span><span class="nf">loginfo</span><span class="p">(</span><span class="sh">"</span><span class="s">Generating optimal trajectory...</span><span class="sh">"</span><span class="p">)</span>
    <span class="n">success</span> <span class="o">=</span> <span class="n">trajectory</span><span class="p">.</span><span class="nf">solve</span><span class="p">(</span>
        <span class="n">waypoints</span><span class="o">=</span><span class="n">waypoints</span><span class="p">,</span>
        <span class="n">aggressiveness</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span>
        <span class="n">start_vel</span><span class="o">=</span><span class="n">np</span><span class="p">.</span><span class="nf">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]),</span>
        <span class="n">end_vel</span><span class="o">=</span><span class="n">np</span><span class="p">.</span><span class="nf">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
    <span class="p">)</span>
    
    <span class="k">if</span> <span class="ow">not</span> <span class="n">success</span><span class="p">:</span>
        <span class="n">rospy</span><span class="p">.</span><span class="nf">logerr</span><span class="p">(</span><span class="sh">"</span><span class="s">Failed to generate trajectory</span><span class="sh">"</span><span class="p">)</span>
        <span class="k">return</span>
    
    <span class="c1"># Convert to ROS path message
</span>    <span class="n">path_msg</span> <span class="o">=</span> <span class="n">trajectory</span><span class="p">.</span><span class="nf">to_path_msg</span><span class="p">(</span><span class="n">dt</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
    
    <span class="c1"># Follow the trajectory
</span>    <span class="n">rospy</span><span class="p">.</span><span class="nf">loginfo</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Following trajectory (duration: </span><span class="si">{</span><span class="n">trajectory</span><span class="p">.</span><span class="nf">get_total_time</span><span class="p">()</span><span class="si">:</span><span class="p">.</span><span class="mi">2</span><span class="n">f</span><span class="si">}</span><span class="s">s)</span><span class="sh">"</span><span class="p">)</span>
    <span class="n">success</span> <span class="o">=</span> <span class="n">motion</span><span class="p">.</span><span class="nf">follow_trajectory</span><span class="p">(</span><span class="n">path_msg</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">success</span><span class="p">:</span>
        <span class="n">rospy</span><span class="p">.</span><span class="nf">loginfo</span><span class="p">(</span><span class="sh">"</span><span class="s">Trajectory completed successfully</span><span class="sh">"</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">rospy</span><span class="p">.</span><span class="nf">logwarn</span><span class="p">(</span><span class="sh">"</span><span class="s">Trajectory following failed</span><span class="sh">"</span><span class="p">)</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="sh">'</span><span class="s">__main__</span><span class="sh">'</span><span class="p">:</span>
    <span class="nf">main</span><span class="p">()</span>
</code></pre></div></div> <h3 id="multi-sensor-state-estimation-example"> <a href="#multi-sensor-state-estimation-example" class="anchor-heading" aria-labelledby="multi-sensor-state-estimation-example"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Multi-Sensor State Estimation Example </h3> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#!/usr/bin/env python
</span><span class="kn">import</span> <span class="n">rospy</span>
<span class="kn">import</span> <span class="n">numpy</span> <span class="k">as</span> <span class="n">np</span>
<span class="kn">from</span> <span class="n">modcube_common.state_estimation</span> <span class="kn">import</span> <span class="n">ExtendedKalmanFilter</span>
<span class="kn">from</span> <span class="n">sensor_msgs.msg</span> <span class="kn">import</span> <span class="n">Imu</span>
<span class="kn">from</span> <span class="n">modcube_msgs.msg</span> <span class="kn">import</span> <span class="n">DVLData</span><span class="p">,</span> <span class="n">FluidDepth</span><span class="p">,</span> <span class="n">NavState</span>
<span class="kn">from</span> <span class="n">geometry_msgs.msg</span> <span class="kn">import</span> <span class="n">PoseWithCovariance</span>

<span class="k">class</span> <span class="nc">StateEstimationNode</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="n">rospy</span><span class="p">.</span><span class="nf">init_node</span><span class="p">(</span><span class="sh">'</span><span class="s">state_estimation_example</span><span class="sh">'</span><span class="p">)</span>
        
        <span class="c1"># Initialize EKF
</span>        <span class="n">initial_state</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">zeros</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span>  <span class="c1"># [pos, vel, acc, euler, ang_vel]
</span>        <span class="n">initial_cov</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">eye</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.1</span>
        <span class="n">self</span><span class="p">.</span><span class="n">ekf</span> <span class="o">=</span> <span class="nc">ExtendedKalmanFilter</span><span class="p">(</span><span class="n">initial_state</span><span class="p">,</span> <span class="n">initial_cov</span><span class="p">)</span>
        
        <span class="c1"># Subscribers
</span>        <span class="n">self</span><span class="p">.</span><span class="n">imu_sub</span> <span class="o">=</span> <span class="n">rospy</span><span class="p">.</span><span class="nc">Subscriber</span><span class="p">(</span><span class="sh">'</span><span class="s">/modcube/imu/data</span><span class="sh">'</span><span class="p">,</span> <span class="n">Imu</span><span class="p">,</span> <span class="n">self</span><span class="p">.</span><span class="n">imu_callback</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">dvl_sub</span> <span class="o">=</span> <span class="n">rospy</span><span class="p">.</span><span class="nc">Subscriber</span><span class="p">(</span><span class="sh">'</span><span class="s">/modcube/dvl/data</span><span class="sh">'</span><span class="p">,</span> <span class="n">DVLData</span><span class="p">,</span> <span class="n">self</span><span class="p">.</span><span class="n">dvl_callback</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">depth_sub</span> <span class="o">=</span> <span class="n">rospy</span><span class="p">.</span><span class="nc">Subscriber</span><span class="p">(</span><span class="sh">'</span><span class="s">/modcube/depth</span><span class="sh">'</span><span class="p">,</span> <span class="n">FluidDepth</span><span class="p">,</span> <span class="n">self</span><span class="p">.</span><span class="n">depth_callback</span><span class="p">)</span>
        
        <span class="c1"># Publishers
</span>        <span class="n">self</span><span class="p">.</span><span class="n">nav_pub</span> <span class="o">=</span> <span class="n">rospy</span><span class="p">.</span><span class="nc">Publisher</span><span class="p">(</span><span class="sh">'</span><span class="s">/modcube/nav_state</span><span class="sh">'</span><span class="p">,</span> <span class="n">NavState</span><span class="p">,</span> <span class="n">queue_size</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
        
        <span class="c1"># Timing
</span>        <span class="n">self</span><span class="p">.</span><span class="n">last_prediction_time</span> <span class="o">=</span> <span class="n">rospy</span><span class="p">.</span><span class="n">Time</span><span class="p">.</span><span class="nf">now</span><span class="p">()</span>
        
        <span class="c1"># Timer for regular state publishing
</span>        <span class="n">self</span><span class="p">.</span><span class="n">timer</span> <span class="o">=</span> <span class="n">rospy</span><span class="p">.</span><span class="nc">Timer</span><span class="p">(</span><span class="n">rospy</span><span class="p">.</span><span class="nc">Duration</span><span class="p">(</span><span class="mf">0.02</span><span class="p">),</span> <span class="n">self</span><span class="p">.</span><span class="n">publish_state</span><span class="p">)</span>  <span class="c1"># 50 Hz
</span>        
        <span class="n">rospy</span><span class="p">.</span><span class="nf">loginfo</span><span class="p">(</span><span class="sh">"</span><span class="s">State estimation node initialized</span><span class="sh">"</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">imu_callback</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">):</span>
        <span class="c1"># Extract IMU data
</span>        <span class="n">accel</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">array</span><span class="p">([</span><span class="n">msg</span><span class="p">.</span><span class="n">linear_acceleration</span><span class="p">.</span><span class="n">x</span><span class="p">,</span>
                         <span class="n">msg</span><span class="p">.</span><span class="n">linear_acceleration</span><span class="p">.</span><span class="n">y</span><span class="p">,</span>
                         <span class="n">msg</span><span class="p">.</span><span class="n">linear_acceleration</span><span class="p">.</span><span class="n">z</span><span class="p">])</span>
        
        <span class="n">ang_vel</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">array</span><span class="p">([</span><span class="n">msg</span><span class="p">.</span><span class="n">angular_velocity</span><span class="p">.</span><span class="n">x</span><span class="p">,</span>
                           <span class="n">msg</span><span class="p">.</span><span class="n">angular_velocity</span><span class="p">.</span><span class="n">y</span><span class="p">,</span>
                           <span class="n">msg</span><span class="p">.</span><span class="n">angular_velocity</span><span class="p">.</span><span class="n">z</span><span class="p">])</span>
        
        <span class="c1"># Optional orientation from IMU
</span>        <span class="n">orientation</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">if</span> <span class="n">msg</span><span class="p">.</span><span class="n">orientation_covariance</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">orientation</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">array</span><span class="p">([</span><span class="n">msg</span><span class="p">.</span><span class="n">orientation</span><span class="p">.</span><span class="n">x</span><span class="p">,</span>
                                   <span class="n">msg</span><span class="p">.</span><span class="n">orientation</span><span class="p">.</span><span class="n">y</span><span class="p">,</span>
                                   <span class="n">msg</span><span class="p">.</span><span class="n">orientation</span><span class="p">.</span><span class="n">z</span><span class="p">,</span>
                                   <span class="n">msg</span><span class="p">.</span><span class="n">orientation</span><span class="p">.</span><span class="n">w</span><span class="p">])</span>
        
        <span class="c1"># Prediction step
</span>        <span class="n">current_time</span> <span class="o">=</span> <span class="n">rospy</span><span class="p">.</span><span class="n">Time</span><span class="p">.</span><span class="nf">now</span><span class="p">()</span>
        <span class="n">dt</span> <span class="o">=</span> <span class="p">(</span><span class="n">current_time</span> <span class="o">-</span> <span class="n">self</span><span class="p">.</span><span class="n">last_prediction_time</span><span class="p">).</span><span class="nf">to_sec</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">dt</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">self</span><span class="p">.</span><span class="n">ekf</span><span class="p">.</span><span class="nf">predict</span><span class="p">(</span><span class="n">dt</span><span class="p">)</span>
            <span class="n">self</span><span class="p">.</span><span class="n">last_prediction_time</span> <span class="o">=</span> <span class="n">current_time</span>
        
        <span class="c1"># Update with IMU measurement
</span>        <span class="n">self</span><span class="p">.</span><span class="n">ekf</span><span class="p">.</span><span class="nf">update_imu</span><span class="p">(</span><span class="n">accel</span><span class="p">,</span> <span class="n">ang_vel</span><span class="p">,</span> <span class="n">orientation</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">dvl_callback</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">):</span>
        <span class="c1"># Extract DVL velocity
</span>        <span class="n">velocity</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">array</span><span class="p">([</span><span class="n">msg</span><span class="p">.</span><span class="n">velocity</span><span class="p">.</span><span class="n">x</span><span class="p">,</span>
                            <span class="n">msg</span><span class="p">.</span><span class="n">velocity</span><span class="p">.</span><span class="n">y</span><span class="p">,</span>
                            <span class="n">msg</span><span class="p">.</span><span class="n">velocity</span><span class="p">.</span><span class="n">z</span><span class="p">])</span>
        
        <span class="c1"># Update with DVL measurement
</span>        <span class="n">self</span><span class="p">.</span><span class="n">ekf</span><span class="p">.</span><span class="nf">update_dvl</span><span class="p">(</span><span class="n">velocity</span><span class="p">,</span> <span class="n">msg</span><span class="p">.</span><span class="n">altitude</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">depth_callback</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">):</span>
        <span class="c1"># Update with depth measurement
</span>        <span class="n">self</span><span class="p">.</span><span class="n">ekf</span><span class="p">.</span><span class="nf">update_depth</span><span class="p">(</span><span class="n">msg</span><span class="p">.</span><span class="n">depth</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">publish_state</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="c1"># Get current state estimate
</span>        <span class="n">state</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">ekf</span><span class="p">.</span><span class="nf">get_state</span><span class="p">()</span>
        <span class="n">covariance</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">ekf</span><span class="p">.</span><span class="nf">get_covariance</span><span class="p">()</span>
        
        <span class="c1"># Create NavState message
</span>        <span class="n">nav_msg</span> <span class="o">=</span> <span class="nc">NavState</span><span class="p">()</span>
        <span class="n">nav_msg</span><span class="p">.</span><span class="n">header</span><span class="p">.</span><span class="n">stamp</span> <span class="o">=</span> <span class="n">rospy</span><span class="p">.</span><span class="n">Time</span><span class="p">.</span><span class="nf">now</span><span class="p">()</span>
        <span class="n">nav_msg</span><span class="p">.</span><span class="n">header</span><span class="p">.</span><span class="n">frame_id</span> <span class="o">=</span> <span class="sh">"</span><span class="s">world</span><span class="sh">"</span>
        
        <span class="c1"># Position and orientation
</span>        <span class="n">nav_msg</span><span class="p">.</span><span class="n">pose</span><span class="p">.</span><span class="n">pose</span><span class="p">.</span><span class="n">position</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">state</span><span class="p">[</span><span class="sh">'</span><span class="s">position</span><span class="sh">'</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">nav_msg</span><span class="p">.</span><span class="n">pose</span><span class="p">.</span><span class="n">pose</span><span class="p">.</span><span class="n">position</span><span class="p">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">state</span><span class="p">[</span><span class="sh">'</span><span class="s">position</span><span class="sh">'</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">nav_msg</span><span class="p">.</span><span class="n">pose</span><span class="p">.</span><span class="n">pose</span><span class="p">.</span><span class="n">position</span><span class="p">.</span><span class="n">z</span> <span class="o">=</span> <span class="n">state</span><span class="p">[</span><span class="sh">'</span><span class="s">position</span><span class="sh">'</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>
        
        <span class="c1"># Convert Euler angles to quaternion
</span>        <span class="kn">from</span> <span class="n">tf.transformations</span> <span class="kn">import</span> <span class="n">quaternion_from_euler</span>
        <span class="n">q</span> <span class="o">=</span> <span class="nf">quaternion_from_euler</span><span class="p">(</span><span class="n">state</span><span class="p">[</span><span class="sh">'</span><span class="s">orientation</span><span class="sh">'</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
                                 <span class="n">state</span><span class="p">[</span><span class="sh">'</span><span class="s">orientation</span><span class="sh">'</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span>
                                 <span class="n">state</span><span class="p">[</span><span class="sh">'</span><span class="s">orientation</span><span class="sh">'</span><span class="p">][</span><span class="mi">2</span><span class="p">])</span>
        <span class="n">nav_msg</span><span class="p">.</span><span class="n">pose</span><span class="p">.</span><span class="n">pose</span><span class="p">.</span><span class="n">orientation</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">q</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">nav_msg</span><span class="p">.</span><span class="n">pose</span><span class="p">.</span><span class="n">pose</span><span class="p">.</span><span class="n">orientation</span><span class="p">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">q</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">nav_msg</span><span class="p">.</span><span class="n">pose</span><span class="p">.</span><span class="n">pose</span><span class="p">.</span><span class="n">orientation</span><span class="p">.</span><span class="n">z</span> <span class="o">=</span> <span class="n">q</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">nav_msg</span><span class="p">.</span><span class="n">pose</span><span class="p">.</span><span class="n">pose</span><span class="p">.</span><span class="n">orientation</span><span class="p">.</span><span class="n">w</span> <span class="o">=</span> <span class="n">q</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
        
        <span class="c1"># Velocity
</span>        <span class="n">nav_msg</span><span class="p">.</span><span class="n">twist</span><span class="p">.</span><span class="n">twist</span><span class="p">.</span><span class="n">linear</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">state</span><span class="p">[</span><span class="sh">'</span><span class="s">velocity</span><span class="sh">'</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">nav_msg</span><span class="p">.</span><span class="n">twist</span><span class="p">.</span><span class="n">twist</span><span class="p">.</span><span class="n">linear</span><span class="p">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">state</span><span class="p">[</span><span class="sh">'</span><span class="s">velocity</span><span class="sh">'</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">nav_msg</span><span class="p">.</span><span class="n">twist</span><span class="p">.</span><span class="n">twist</span><span class="p">.</span><span class="n">linear</span><span class="p">.</span><span class="n">z</span> <span class="o">=</span> <span class="n">state</span><span class="p">[</span><span class="sh">'</span><span class="s">velocity</span><span class="sh">'</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>
        
        <span class="c1"># Angular velocity
</span>        <span class="n">nav_msg</span><span class="p">.</span><span class="n">twist</span><span class="p">.</span><span class="n">twist</span><span class="p">.</span><span class="n">angular</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">state</span><span class="p">[</span><span class="sh">'</span><span class="s">angular_velocity</span><span class="sh">'</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">nav_msg</span><span class="p">.</span><span class="n">twist</span><span class="p">.</span><span class="n">twist</span><span class="p">.</span><span class="n">angular</span><span class="p">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">state</span><span class="p">[</span><span class="sh">'</span><span class="s">angular_velocity</span><span class="sh">'</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">nav_msg</span><span class="p">.</span><span class="n">twist</span><span class="p">.</span><span class="n">twist</span><span class="p">.</span><span class="n">angular</span><span class="p">.</span><span class="n">z</span> <span class="o">=</span> <span class="n">state</span><span class="p">[</span><span class="sh">'</span><span class="s">angular_velocity</span><span class="sh">'</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>
        
        <span class="c1"># Covariance (simplified - position only)
</span>        <span class="n">nav_msg</span><span class="p">.</span><span class="n">pose</span><span class="p">.</span><span class="n">covariance</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">covariance</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>  <span class="c1"># x-x
</span>        <span class="n">nav_msg</span><span class="p">.</span><span class="n">pose</span><span class="p">.</span><span class="n">covariance</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="o">=</span> <span class="n">covariance</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>  <span class="c1"># y-y
</span>        <span class="n">nav_msg</span><span class="p">.</span><span class="n">pose</span><span class="p">.</span><span class="n">covariance</span><span class="p">[</span><span class="mi">14</span><span class="p">]</span> <span class="o">=</span> <span class="n">covariance</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>  <span class="c1"># z-z
</span>        
        <span class="c1"># Publish
</span>        <span class="n">self</span><span class="p">.</span><span class="n">nav_pub</span><span class="p">.</span><span class="nf">publish</span><span class="p">(</span><span class="n">nav_msg</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="n">rospy</span><span class="p">.</span><span class="nf">spin</span><span class="p">()</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="sh">'</span><span class="s">__main__</span><span class="sh">'</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">node</span> <span class="o">=</span> <span class="nc">StateEstimationNode</span><span class="p">()</span>
        <span class="n">node</span><span class="p">.</span><span class="nf">run</span><span class="p">()</span>
    <span class="k">except</span> <span class="n">rospy</span><span class="p">.</span><span class="n">ROSInterruptException</span><span class="p">:</span>
        <span class="k">pass</span>
</code></pre></div></div> <h3 id="autonomous-survey-mission-example"> <a href="#autonomous-survey-mission-example" class="anchor-heading" aria-labelledby="autonomous-survey-mission-example"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Autonomous Survey Mission Example </h3> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#!/usr/bin/env python
</span><span class="kn">import</span> <span class="n">rospy</span>
<span class="kn">import</span> <span class="n">numpy</span> <span class="k">as</span> <span class="n">np</span>
<span class="kn">from</span> <span class="n">modcube_mission</span> <span class="kn">import</span> <span class="n">MissionManager</span>
<span class="kn">from</span> <span class="n">modcube_common.navigation</span> <span class="kn">import</span> <span class="n">PathPlanner</span><span class="p">,</span> <span class="n">ObstacleAvoidance</span>
<span class="kn">from</span> <span class="n">modcube_common.motion</span> <span class="kn">import</span> <span class="n">MotionClient</span>
<span class="kn">from</span> <span class="n">modcube_msgs.msg</span> <span class="kn">import</span> <span class="n">NavState</span>
<span class="kn">from</span> <span class="n">sensor_msgs.msg</span> <span class="kn">import</span> <span class="n">PointCloud2</span>
<span class="kn">from</span> <span class="n">nav_msgs.msg</span> <span class="kn">import</span> <span class="n">OccupancyGrid</span>

<span class="k">class</span> <span class="nc">AutonomousSurveyMission</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="n">rospy</span><span class="p">.</span><span class="nf">init_node</span><span class="p">(</span><span class="sh">'</span><span class="s">autonomous_survey_mission</span><span class="sh">'</span><span class="p">)</span>
        
        <span class="c1"># Initialize components
</span>        <span class="n">self</span><span class="p">.</span><span class="n">motion</span> <span class="o">=</span> <span class="nc">MotionClient</span><span class="p">()</span>
        <span class="n">self</span><span class="p">.</span><span class="n">path_planner</span> <span class="o">=</span> <span class="nc">PathPlanner</span><span class="p">(</span><span class="n">planning_algorithm</span><span class="o">=</span><span class="sh">'</span><span class="s">A*</span><span class="sh">'</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">obstacle_avoidance</span> <span class="o">=</span> <span class="nc">ObstacleAvoidance</span><span class="p">(</span><span class="n">safety_distance</span><span class="o">=</span><span class="mf">3.0</span><span class="p">)</span>
        
        <span class="c1"># Mission parameters
</span>        <span class="n">self</span><span class="p">.</span><span class="n">survey_area</span> <span class="o">=</span> <span class="p">{</span>
            <span class="sh">'</span><span class="s">min_x</span><span class="sh">'</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="sh">'</span><span class="s">max_x</span><span class="sh">'</span><span class="p">:</span> <span class="mi">50</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">min_y</span><span class="sh">'</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="sh">'</span><span class="s">max_y</span><span class="sh">'</span><span class="p">:</span> <span class="mi">30</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">depth</span><span class="sh">'</span><span class="p">:</span> <span class="o">-</span><span class="mf">5.0</span>
        <span class="p">}</span>
        <span class="n">self</span><span class="p">.</span><span class="n">line_spacing</span> <span class="o">=</span> <span class="mf">5.0</span>  <span class="c1"># meters between survey lines
</span>        <span class="n">self</span><span class="p">.</span><span class="n">survey_speed</span> <span class="o">=</span> <span class="mf">1.0</span>  <span class="c1"># m/s
</span>        
        <span class="c1"># State tracking
</span>        <span class="n">self</span><span class="p">.</span><span class="n">current_pose</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">self</span><span class="p">.</span><span class="n">obstacles</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="c1"># Subscribers
</span>        <span class="n">self</span><span class="p">.</span><span class="n">nav_sub</span> <span class="o">=</span> <span class="n">rospy</span><span class="p">.</span><span class="nc">Subscriber</span><span class="p">(</span><span class="sh">'</span><span class="s">/modcube/nav_state</span><span class="sh">'</span><span class="p">,</span> <span class="n">NavState</span><span class="p">,</span> <span class="n">self</span><span class="p">.</span><span class="n">nav_callback</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">sonar_sub</span> <span class="o">=</span> <span class="n">rospy</span><span class="p">.</span><span class="nc">Subscriber</span><span class="p">(</span><span class="sh">'</span><span class="s">/modcube/sonar/pointcloud</span><span class="sh">'</span><span class="p">,</span> <span class="n">PointCloud2</span><span class="p">,</span> <span class="n">self</span><span class="p">.</span><span class="n">sonar_callback</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">map_sub</span> <span class="o">=</span> <span class="n">rospy</span><span class="p">.</span><span class="nc">Subscriber</span><span class="p">(</span><span class="sh">'</span><span class="s">/modcube/occupancy_grid</span><span class="sh">'</span><span class="p">,</span> <span class="n">OccupancyGrid</span><span class="p">,</span> <span class="n">self</span><span class="p">.</span><span class="n">map_callback</span><span class="p">)</span>
        
        <span class="n">rospy</span><span class="p">.</span><span class="nf">loginfo</span><span class="p">(</span><span class="sh">"</span><span class="s">Autonomous survey mission initialized</span><span class="sh">"</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">nav_callback</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">current_pose</span> <span class="o">=</span> <span class="n">msg</span><span class="p">.</span><span class="n">pose</span><span class="p">.</span><span class="n">pose</span>
    
    <span class="k">def</span> <span class="nf">sonar_callback</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">):</span>
        <span class="c1"># Process sonar data for obstacle detection
</span>        <span class="n">self</span><span class="p">.</span><span class="n">obstacle_avoidance</span><span class="p">.</span><span class="nf">update_obstacles</span><span class="p">({</span><span class="sh">'</span><span class="s">sonar</span><span class="sh">'</span><span class="p">:</span> <span class="n">msg</span><span class="p">})</span>
    
    <span class="k">def</span> <span class="nf">map_callback</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">):</span>
        <span class="c1"># Update path planner with new map
</span>        <span class="n">self</span><span class="p">.</span><span class="n">path_planner</span><span class="p">.</span><span class="nf">update_map</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">generate_survey_pattern</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Generate lawnmower survey pattern.</span><span class="sh">"""</span>
        <span class="n">waypoints</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="n">y</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">survey_area</span><span class="p">[</span><span class="sh">'</span><span class="s">min_y</span><span class="sh">'</span><span class="p">]</span>
        <span class="n">direction</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># 1 for positive x, -1 for negative x
</span>        
        <span class="k">while</span> <span class="n">y</span> <span class="o">&lt;=</span> <span class="n">self</span><span class="p">.</span><span class="n">survey_area</span><span class="p">[</span><span class="sh">'</span><span class="s">max_y</span><span class="sh">'</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">direction</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="c1"># Left to right
</span>                <span class="n">start_x</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">survey_area</span><span class="p">[</span><span class="sh">'</span><span class="s">min_x</span><span class="sh">'</span><span class="p">]</span>
                <span class="n">end_x</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">survey_area</span><span class="p">[</span><span class="sh">'</span><span class="s">max_x</span><span class="sh">'</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Right to left
</span>                <span class="n">start_x</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">survey_area</span><span class="p">[</span><span class="sh">'</span><span class="s">max_x</span><span class="sh">'</span><span class="p">]</span>
                <span class="n">end_x</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">survey_area</span><span class="p">[</span><span class="sh">'</span><span class="s">min_x</span><span class="sh">'</span><span class="p">]</span>
            
            <span class="n">waypoints</span><span class="p">.</span><span class="nf">append</span><span class="p">([</span><span class="n">start_x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">self</span><span class="p">.</span><span class="n">survey_area</span><span class="p">[</span><span class="sh">'</span><span class="s">depth</span><span class="sh">'</span><span class="p">]])</span>
            <span class="n">waypoints</span><span class="p">.</span><span class="nf">append</span><span class="p">([</span><span class="n">end_x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">self</span><span class="p">.</span><span class="n">survey_area</span><span class="p">[</span><span class="sh">'</span><span class="s">depth</span><span class="sh">'</span><span class="p">]])</span>
            
            <span class="n">y</span> <span class="o">+=</span> <span class="n">self</span><span class="p">.</span><span class="n">line_spacing</span>
            <span class="n">direction</span> <span class="o">*=</span> <span class="o">-</span><span class="mi">1</span>
        
        <span class="k">return</span> <span class="n">waypoints</span>
    
    <span class="k">def</span> <span class="nf">execute_survey</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Execute the survey mission.</span><span class="sh">"""</span>
        <span class="n">rospy</span><span class="p">.</span><span class="nf">loginfo</span><span class="p">(</span><span class="sh">"</span><span class="s">Starting autonomous survey mission</span><span class="sh">"</span><span class="p">)</span>
        
        <span class="c1"># Wait for initial position
</span>        <span class="k">while</span> <span class="n">self</span><span class="p">.</span><span class="n">current_pose</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">rospy</span><span class="p">.</span><span class="nf">is_shutdown</span><span class="p">():</span>
            <span class="n">rospy</span><span class="p">.</span><span class="nf">loginfo</span><span class="p">(</span><span class="sh">"</span><span class="s">Waiting for navigation state...</span><span class="sh">"</span><span class="p">)</span>
            <span class="n">rospy</span><span class="p">.</span><span class="nf">sleep</span><span class="p">(</span><span class="mf">1.0</span><span class="p">)</span>
        
        <span class="c1"># Generate survey pattern
</span>        <span class="n">waypoints</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">generate_survey_pattern</span><span class="p">()</span>
        <span class="n">rospy</span><span class="p">.</span><span class="nf">loginfo</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Generated </span><span class="si">{</span><span class="nf">len</span><span class="p">(</span><span class="n">waypoints</span><span class="p">)</span><span class="si">}</span><span class="s"> waypoints</span><span class="sh">"</span><span class="p">)</span>
        
        <span class="c1"># Execute waypoints with obstacle avoidance
</span>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">waypoint</span> <span class="ow">in</span> <span class="nf">enumerate</span><span class="p">(</span><span class="n">waypoints</span><span class="p">):</span>
            <span class="n">rospy</span><span class="p">.</span><span class="nf">loginfo</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Navigating to waypoint </span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s">/</span><span class="si">{</span><span class="nf">len</span><span class="p">(</span><span class="n">waypoints</span><span class="p">)</span><span class="si">}</span><span class="s">: </span><span class="si">{</span><span class="n">waypoint</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
            
            <span class="c1"># Plan path to waypoint
</span>            <span class="n">current_pos</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">array</span><span class="p">([</span>
                <span class="n">self</span><span class="p">.</span><span class="n">current_pose</span><span class="p">.</span><span class="n">position</span><span class="p">.</span><span class="n">x</span><span class="p">,</span>
                <span class="n">self</span><span class="p">.</span><span class="n">current_pose</span><span class="p">.</span><span class="n">position</span><span class="p">.</span><span class="n">y</span><span class="p">,</span>
                <span class="n">self</span><span class="p">.</span><span class="n">current_pose</span><span class="p">.</span><span class="n">position</span><span class="p">.</span><span class="n">z</span>
            <span class="p">])</span>
            
            <span class="n">path</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">path_planner</span><span class="p">.</span><span class="nf">plan_path</span><span class="p">(</span>
                <span class="n">start</span><span class="o">=</span><span class="n">current_pos</span><span class="p">,</span>
                <span class="n">goal</span><span class="o">=</span><span class="n">np</span><span class="p">.</span><span class="nf">array</span><span class="p">(</span><span class="n">waypoint</span><span class="p">),</span>
                <span class="n">constraints</span><span class="o">=</span><span class="p">{</span><span class="sh">'</span><span class="s">max_velocity</span><span class="sh">'</span><span class="p">:</span> <span class="n">self</span><span class="p">.</span><span class="n">survey_speed</span><span class="p">}</span>
            <span class="p">)</span>
            
            <span class="k">if</span> <span class="n">path</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">rospy</span><span class="p">.</span><span class="nf">logwarn</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Failed to plan path to waypoint </span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
                <span class="k">continue</span>
            
            <span class="c1"># Execute path with real-time obstacle avoidance
</span>            <span class="n">success</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">execute_path_with_avoidance</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
            
            <span class="k">if</span> <span class="ow">not</span> <span class="n">success</span><span class="p">:</span>
                <span class="n">rospy</span><span class="p">.</span><span class="nf">logwarn</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Failed to reach waypoint </span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
                <span class="c1"># Decide whether to continue or abort mission
</span>                <span class="k">continue</span>
            
            <span class="n">rospy</span><span class="p">.</span><span class="nf">loginfo</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Reached waypoint </span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
        
        <span class="n">rospy</span><span class="p">.</span><span class="nf">loginfo</span><span class="p">(</span><span class="sh">"</span><span class="s">Survey mission completed</span><span class="sh">"</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">execute_path_with_avoidance</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Execute path with real-time obstacle avoidance.</span><span class="sh">"""</span>
        <span class="n">rate</span> <span class="o">=</span> <span class="n">rospy</span><span class="p">.</span><span class="nc">Rate</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>  <span class="c1"># 10 Hz control loop
</span>        
        <span class="k">for</span> <span class="n">waypoint</span> <span class="ow">in</span> <span class="n">path</span><span class="p">:</span>
            <span class="c1"># Check for obstacles and compute avoidance
</span>            <span class="n">current_pos</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">array</span><span class="p">([</span>
                <span class="n">self</span><span class="p">.</span><span class="n">current_pose</span><span class="p">.</span><span class="n">position</span><span class="p">.</span><span class="n">x</span><span class="p">,</span>
                <span class="n">self</span><span class="p">.</span><span class="n">current_pose</span><span class="p">.</span><span class="n">position</span><span class="p">.</span><span class="n">y</span><span class="p">,</span>
                <span class="n">self</span><span class="p">.</span><span class="n">current_pose</span><span class="p">.</span><span class="n">position</span><span class="p">.</span><span class="n">z</span>
            <span class="p">])</span>
            
            <span class="n">target_velocity</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="nf">array</span><span class="p">(</span><span class="n">waypoint</span><span class="p">)</span> <span class="o">-</span> <span class="n">current_pos</span><span class="p">)</span>
            <span class="n">target_velocity</span> <span class="o">=</span> <span class="n">target_velocity</span> <span class="o">/</span> <span class="n">np</span><span class="p">.</span><span class="n">linalg</span><span class="p">.</span><span class="nf">norm</span><span class="p">(</span><span class="n">target_velocity</span><span class="p">)</span> <span class="o">*</span> <span class="n">self</span><span class="p">.</span><span class="n">survey_speed</span>
            
            <span class="c1"># Compute obstacle avoidance force
</span>            <span class="n">avoidance_force</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">obstacle_avoidance</span><span class="p">.</span><span class="nf">compute_avoidance_force</span><span class="p">(</span>
                <span class="n">current_pos</span><span class="p">,</span> <span class="n">self</span><span class="p">.</span><span class="n">obstacles</span><span class="p">,</span> <span class="n">target_velocity</span>
            <span class="p">)</span>
            
            <span class="c1"># Combine target velocity with avoidance
</span>            <span class="n">modified_velocity</span> <span class="o">=</span> <span class="n">target_velocity</span> <span class="o">+</span> <span class="n">avoidance_force</span>
            
            <span class="c1"># Send velocity command
</span>            <span class="n">success</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">motion</span><span class="p">.</span><span class="nf">goto_position</span><span class="p">(</span>
                <span class="n">waypoint</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">waypoint</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">waypoint</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
                <span class="n">timeout</span><span class="o">=</span><span class="mf">10.0</span>
            <span class="p">)</span>
            
            <span class="k">if</span> <span class="ow">not</span> <span class="n">success</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">False</span>
            
            <span class="n">rate</span><span class="p">.</span><span class="nf">sleep</span><span class="p">()</span>
        
        <span class="k">return</span> <span class="bp">True</span>
    
    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Run the mission.</span><span class="sh">"""</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">self</span><span class="p">.</span><span class="nf">execute_survey</span><span class="p">()</span>
        <span class="k">except</span> <span class="n">rospy</span><span class="p">.</span><span class="n">ROSInterruptException</span><span class="p">:</span>
            <span class="n">rospy</span><span class="p">.</span><span class="nf">loginfo</span><span class="p">(</span><span class="sh">"</span><span class="s">Mission interrupted</span><span class="sh">"</span><span class="p">)</span>
        <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">rospy</span><span class="p">.</span><span class="nf">logerr</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Mission failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="sh">'</span><span class="s">__main__</span><span class="sh">'</span><span class="p">:</span>
    <span class="n">mission</span> <span class="o">=</span> <span class="nc">AutonomousSurveyMission</span><span class="p">()</span>
    <span class="n">mission</span><span class="p">.</span><span class="nf">run</span><span class="p">()</span>
</code></pre></div></div> <h3 id="mission-planning-example"> <a href="#mission-planning-example" class="anchor-heading" aria-labelledby="mission-planning-example"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Mission Planning Example </h3> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#!/usr/bin/env python
</span><span class="kn">import</span> <span class="n">rospy</span>
<span class="kn">from</span> <span class="n">modcube_mission</span> <span class="kn">import</span> <span class="n">MissionManager</span>
<span class="kn">from</span> <span class="n">modcube_mission.missions</span> <span class="kn">import</span> <span class="n">WaypointMission</span><span class="p">,</span> <span class="n">SearchMission</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">rospy</span><span class="p">.</span><span class="nf">init_node</span><span class="p">(</span><span class="sh">'</span><span class="s">mission_example</span><span class="sh">'</span><span class="p">)</span>
    
    <span class="c1"># Initialize mission manager
</span>    <span class="n">mission_mgr</span> <span class="o">=</span> <span class="nc">MissionManager</span><span class="p">()</span>
    
    <span class="c1"># Register custom mission types
</span>    <span class="n">mission_mgr</span><span class="p">.</span><span class="nf">register_mission_type</span><span class="p">(</span><span class="sh">'</span><span class="s">waypoint</span><span class="sh">'</span><span class="p">,</span> <span class="n">WaypointMission</span><span class="p">)</span>
    <span class="n">mission_mgr</span><span class="p">.</span><span class="nf">register_mission_type</span><span class="p">(</span><span class="sh">'</span><span class="s">search</span><span class="sh">'</span><span class="p">,</span> <span class="n">SearchMission</span><span class="p">)</span>
    
    <span class="c1"># Start waypoint mission
</span>    <span class="n">waypoint_params</span> <span class="o">=</span> <span class="p">{</span>
        <span class="sh">'</span><span class="s">waypoints</span><span class="sh">'</span><span class="p">:</span> <span class="p">[</span>
            <span class="p">{</span><span class="sh">'</span><span class="s">x</span><span class="sh">'</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="sh">'</span><span class="s">y</span><span class="sh">'</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="sh">'</span><span class="s">z</span><span class="sh">'</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">},</span>
            <span class="p">{</span><span class="sh">'</span><span class="s">x</span><span class="sh">'</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span> <span class="sh">'</span><span class="s">y</span><span class="sh">'</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="sh">'</span><span class="s">z</span><span class="sh">'</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">},</span>
            <span class="p">{</span><span class="sh">'</span><span class="s">x</span><span class="sh">'</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span> <span class="sh">'</span><span class="s">y</span><span class="sh">'</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span> <span class="sh">'</span><span class="s">z</span><span class="sh">'</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">},</span>
            <span class="p">{</span><span class="sh">'</span><span class="s">x</span><span class="sh">'</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="sh">'</span><span class="s">y</span><span class="sh">'</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span> <span class="sh">'</span><span class="s">z</span><span class="sh">'</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">}</span>
        <span class="p">],</span>
        <span class="sh">'</span><span class="s">speed</span><span class="sh">'</span><span class="p">:</span> <span class="mf">0.5</span>
    <span class="p">}</span>
    
    <span class="n">mission_id</span> <span class="o">=</span> <span class="n">mission_mgr</span><span class="p">.</span><span class="nf">start_mission</span><span class="p">(</span><span class="sh">'</span><span class="s">waypoint</span><span class="sh">'</span><span class="p">,</span> <span class="n">waypoint_params</span><span class="p">)</span>
    <span class="n">rospy</span><span class="p">.</span><span class="nf">loginfo</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Started mission: </span><span class="si">{</span><span class="n">mission_id</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
    
    <span class="c1"># Monitor mission progress
</span>    <span class="n">rate</span> <span class="o">=</span> <span class="n">rospy</span><span class="p">.</span><span class="nc">Rate</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># 1 Hz
</span>    <span class="k">while</span> <span class="ow">not</span> <span class="n">rospy</span><span class="p">.</span><span class="nf">is_shutdown</span><span class="p">():</span>
        <span class="n">status</span> <span class="o">=</span> <span class="n">mission_mgr</span><span class="p">.</span><span class="nf">get_mission_status</span><span class="p">(</span><span class="n">mission_id</span><span class="p">)</span>
        <span class="n">rospy</span><span class="p">.</span><span class="nf">loginfo</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Mission status: </span><span class="si">{</span><span class="n">status</span><span class="p">[</span><span class="sh">'</span><span class="s">state</span><span class="sh">'</span><span class="p">]</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">status</span><span class="p">[</span><span class="sh">'</span><span class="s">state</span><span class="sh">'</span><span class="p">]</span> <span class="o">==</span> <span class="sh">'</span><span class="s">completed</span><span class="sh">'</span><span class="p">:</span>
            <span class="k">break</span>
        
        <span class="n">rate</span><span class="p">.</span><span class="nf">sleep</span><span class="p">()</span>
    
    <span class="n">rospy</span><span class="p">.</span><span class="nf">loginfo</span><span class="p">(</span><span class="sh">"</span><span class="s">Mission completed successfully</span><span class="sh">"</span><span class="p">)</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="sh">'</span><span class="s">__main__</span><span class="sh">'</span><span class="p">:</span>
    <span class="nf">main</span><span class="p">()</span>
</code></pre></div></div> <h3 id="sensor-integration-example"> <a href="#sensor-integration-example" class="anchor-heading" aria-labelledby="sensor-integration-example"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Sensor Integration Example </h3> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#!/usr/bin/env python
</span><span class="kn">import</span> <span class="n">rospy</span>
<span class="kn">from</span> <span class="n">modcube_common.state_estimation</span> <span class="kn">import</span> <span class="n">StateEstimator</span>
<span class="kn">from</span> <span class="n">sensor_msgs.msg</span> <span class="kn">import</span> <span class="n">Imu</span>
<span class="kn">from</span> <span class="n">modcube_msgs.msg</span> <span class="kn">import</span> <span class="n">DVLData</span><span class="p">,</span> <span class="n">NavState</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">rospy</span><span class="p">.</span><span class="nf">init_node</span><span class="p">(</span><span class="sh">'</span><span class="s">sensor_integration_example</span><span class="sh">'</span><span class="p">)</span>
    
    <span class="c1"># Initialize state estimator
</span>    <span class="n">estimator</span> <span class="o">=</span> <span class="nc">StateEstimator</span><span class="p">()</span>
    
    <span class="c1"># Add sensors
</span>    <span class="n">estimator</span><span class="p">.</span><span class="nf">add_sensor</span><span class="p">(</span><span class="sh">'</span><span class="s">imu</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">/modcube/imu/data</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">imu_link</span><span class="sh">'</span><span class="p">)</span>
    <span class="n">estimator</span><span class="p">.</span><span class="nf">add_sensor</span><span class="p">(</span><span class="sh">'</span><span class="s">dvl</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">/modcube/dvl/data</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">dvl_link</span><span class="sh">'</span><span class="p">)</span>
    <span class="n">estimator</span><span class="p">.</span><span class="nf">add_sensor</span><span class="p">(</span><span class="sh">'</span><span class="s">depth</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">/modcube/depth</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">depth_link</span><span class="sh">'</span><span class="p">)</span>
    
    <span class="c1"># Publisher for estimated state
</span>    <span class="n">nav_pub</span> <span class="o">=</span> <span class="n">rospy</span><span class="p">.</span><span class="nc">Publisher</span><span class="p">(</span><span class="sh">'</span><span class="s">/modcube/nav_state</span><span class="sh">'</span><span class="p">,</span> <span class="n">NavState</span><span class="p">,</span> <span class="n">queue_size</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
    
    <span class="n">rate</span> <span class="o">=</span> <span class="n">rospy</span><span class="p">.</span><span class="nc">Rate</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span>  <span class="c1"># 50 Hz
</span>    
    <span class="k">while</span> <span class="ow">not</span> <span class="n">rospy</span><span class="p">.</span><span class="nf">is_shutdown</span><span class="p">():</span>
        <span class="c1"># Get current estimated state
</span>        <span class="n">state</span> <span class="o">=</span> <span class="n">estimator</span><span class="p">.</span><span class="nf">get_state</span><span class="p">()</span>
        
        <span class="c1"># Publish state
</span>        <span class="n">nav_pub</span><span class="p">.</span><span class="nf">publish</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>
        
        <span class="n">rate</span><span class="p">.</span><span class="nf">sleep</span><span class="p">()</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="sh">'</span><span class="s">__main__</span><span class="sh">'</span><span class="p">:</span>
    <span class="nf">main</span><span class="p">()</span>
</code></pre></div></div> <p>This API documentation provides a comprehensive reference for developing with the RS-ModCubes system. For more examples and detailed usage, refer to the source code and example implementations in the repository.</p> </main> <hr> <footer> <p><a href="#top" id="back-to-top">Back to top</a></p> <p class="text-small text-grey-dk-100 mb-0">Copyright &copy; 2024 Jiaxi Zheng. Distributed by an <a href="https://github.com/jiaxi-zheng/ModCube.github.io/tree/main/LICENSE">MIT license.</a></p> </footer> </div> </div> <div class="search-overlay"></div> </div> </body> </html>
